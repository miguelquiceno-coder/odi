<?xml version="1.0" encoding="ISO-8859-1"?>
<SunopsisExport>
<Admin RepositoryVersion="05.02.01.08" IsLegacyIdCompatible="false" />
<Encryption algorithm="AES" keyLength="128" exportKeyHash="UuQ9fbZaJGHxSDU5RDTnrFDYBmGdmuwQGGDW6FQ2TNI=" keyVect="uooQpQJp4wPgQw/wd6F9WQ==" exportKeySalt="54d66122-fa4e-4ef0-bc6e-61c17b374d5c" containsCipherText="false"/>
<Object class="com.sunopsis.dwg.dbobj.SnpTrt">
		<Field name="BaseKmType" type="java.lang.String">null</Field>
	<Field name="CleanupOnError" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="CompType" type="java.lang.String">null</Field>
	<Field name="DelegateClass" type="java.lang.String">null</Field>
	<Field name="DelegateScript" type="java.lang.String">null</Field>
	<Field name="ExpectedAstClass" type="java.lang.String">null</Field>
	<Field name="ExtVersion" type="java.lang.String">null</Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2017-09-15 09:08:04.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[SUPERVISOR]]></Field>
	<Field name="GenType" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[4a881e94-ef88-41c4-af9f-f1a22ba247b3]]></Field>
	<Field name="IndChange" type="java.lang.String"><![CDATA[U]]></Field>
	<Field name="IndJrnMethod" type="java.lang.String">null</Field>
	<Field name="IndSuppSetBased" type="java.lang.String">null</Field>
	<Field name="IntgType" type="java.lang.String">null</Field>
	<Field name="IntVersion" type="com.sunopsis.sql.DbInt"><![CDATA[217]]></Field>
	<Field name="IsConcurrent" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IsSeeded" type="java.lang.String">null</Field>
	<Field name="IBaseCompKm" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IFolder" type="com.sunopsis.sql.DbInt"><![CDATA[1051]]></Field>
	<Field name="IProject" type="com.sunopsis.sql.DbInt"><![CDATA[91]]></Field>
	<Field name="IScBaseTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScOrigTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScTrt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IState" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="ITxtTrtTxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KimMultiDserver" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KmDefault" type="java.lang.String">null</Field>
	<Field name="KmSrcTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="KmTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="KmVersion" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2024-05-31 14:29:55.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[FNIÑO]]></Field>
	<Field name="LkmType" type="java.lang.String">null</Field>
	<Field name="LChecksum" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LCode" type="java.lang.String">null</Field>
	<Field name="OggJkm" type="java.lang.String">null</Field>
	<Field name="OrdFolder" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ProcType" type="java.lang.String">null</Field>
	<Field name="ProdAstType" type="java.lang.String">null</Field>
	<Field name="RepGuid" type="java.lang.String">null</Field>
	<Field name="RepVersion" type="java.lang.String">null</Field>
	<Field name="ScriptPath" type="java.lang.String">null</Field>
	<Field name="ScOrigTrtTag" type="java.lang.String">null</Field>
	<Field name="Subtype" type="java.lang.String">null</Field>
	<Field name="TrtName" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TrtType" type="java.lang.String"><![CDATA[U]]></Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
	<Field name="VLastDate" type="java.sql.Timestamp">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScen">
		<Field name="CecSessBehavior" type="java.lang.String">null</Field>
	<Field name="CecSessPollIntv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ExtVersion" type="java.lang.String">null</Field>
	<Field name="FirstDate" type="java.sql.Timestamp"><![CDATA[2024-05-31 14:30:10.0]]></Field>
	<Field name="FirstUser" type="java.lang.String"><![CDATA[FNIÑO]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[bd22c103-873e-4203-8f7c-adafef20a8de]]></Field>
	<Field name="IndChange" type="java.lang.String"><![CDATA[U]]></Field>
	<Field name="IndPromptParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="IntVersion" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="IsMaterialized" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IDeploySpec" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IMapping" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IPackage" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IPop" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IScenFolder" type="com.sunopsis.sql.DbInt"><![CDATA[735]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="ITxtScen" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="IVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LastDate" type="java.sql.Timestamp"><![CDATA[2024-05-31 14:30:16.0]]></Field>
	<Field name="LastUser" type="java.lang.String"><![CDATA[FNIÑO]]></Field>
	<Field name="MaxCecSess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="RepGuid" type="java.lang.String">null</Field>
	<Field name="RepVersion" type="java.lang.String">null</Field>
	<Field name="ScenName" type="java.lang.String"><![CDATA[CASO_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenSnapshotNo" type="com.sunopsis.sql.DbInt"><![CDATA[104]]></Field>
	<Field name="ScenVersion" type="java.lang.String"><![CDATA[001]]></Field>
	<Field name="VLastDate" type="java.sql.Timestamp">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session CASO_EXO_CALCULAR_STATS_CUENTAS (248754) fails with return code 20103.
ODI-1226: Step PRC_EXO_CALCULAR_STATS_CUENTAS fails after 1 attempt(s).
ODI-1232: Procedure PRC_EXO_CALCULAR_STATS_CUENTAS execution fails.
ODI-1228: Task Procedimiento-PRC_EXO_CALCULAR_STATS_CUENTAS-Calcular Estadisticos de Saldos de Cuentas fails on the target connection C_TRIBUTARIO.
Caused By: java.sql.SQLException: ORA-20103: Ocurrió un error al actualizar la información de cuentas con el saldo Final
ORA-06512: at line 176

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:466)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:407)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1113)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:546)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:603)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:218)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:31)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1000)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1316)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:2168)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:2100)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:363)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:205)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:141)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:206)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:117)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2227)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:607)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1497e34e-3312-4870-87d9-45db81d660a1]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248754]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:27:26.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:27:27.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[20103]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session CASO_EXO_CALCULAR_STATS_CUENTAS (248755) fails with return code 20103.
ODI-1226: Step PRC_EXO_CALCULAR_STATS_CUENTAS fails after 1 attempt(s).
ODI-1232: Procedure PRC_EXO_CALCULAR_STATS_CUENTAS execution fails.
ODI-1228: Task Procedimiento-PRC_EXO_CALCULAR_STATS_CUENTAS-Calcular Estadisticos de Saldos de Cuentas fails on the target connection C_TRIBUTARIO.
Caused By: java.sql.SQLException: ORA-20103: Ocurrió un error al actualizar la información de cuentas con el saldo Final
ORA-06512: at line 176

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:466)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:407)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1113)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:546)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:603)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:218)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:31)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1000)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1316)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:2168)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:2100)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:363)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:205)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:141)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:206)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:117)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2227)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:607)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f6dc8b92-962e-4b41-800d-c19f4f38385c]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248755]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:32:21.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[0]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:32:21.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[20103]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session CASO_EXO_CALCULAR_STATS_CUENTAS (248756) fails with return code 923.
ODI-1226: Step PRC_EXO_CALCULAR_STATS_CUENTAS fails after 1 attempt(s).
ODI-1232: Procedure PRC_EXO_CALCULAR_STATS_CUENTAS execution fails.
ODI-1228: Task Procedimiento-PRC_EXO_CALCULAR_STATS_CUENTAS-Insertar en wtmp_cuentas_debito_exo fails on the target connection C_TRIBUTARIO.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00923: FROM keyword not found where expected
ORA-06512: at line 104

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:466)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:407)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1113)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:546)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:603)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:218)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:31)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1000)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1316)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:2168)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:2100)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:363)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:205)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:141)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:206)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:117)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2227)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:607)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[93e70950-ab46-4363-b1fe-58fc4a47523d]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248756]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:37:22.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[2]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:37:24.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[923]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[dd8dac6c-0b4a-42d7-8336-8be54acd77f0]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248810]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:49:54.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[20]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:50:14.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session CASO_EXO_CALCULAR_STATS_CUENTAS (248811) fails with return code 904.
ODI-1226: Step PRC_EXO_CALCULAR_STATS_CUENTAS fails after 1 attempt(s).
ODI-1232: Procedure PRC_EXO_CALCULAR_STATS_CUENTAS execution fails.
ODI-1228: Task Procedimiento-PRC_EXO_CALCULAR_STATS_CUENTAS-minus logico debitos y creditos, exogena y cheques fails on the target connection C_TRIBUTARIO.
Caused By: java.sql.SQLSyntaxErrorException: ORA-00904: "CDC"."MOTIVO_CONCEPTO": invalid identifier
ORA-06512: at line 57

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:466)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:407)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1113)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:546)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:603)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:218)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:31)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1000)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1316)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:2168)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:2100)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:363)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:205)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:141)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:206)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:117)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2227)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:607)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[bebf893a-2ac1-4d36-a23f-71bd29a4f386]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248811]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:52:15.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[16]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:52:31.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[904]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[150659c6-f0bf-4024-b459-4bbbc7d59a94]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248812]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:58:41.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[17]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 15:58:58.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[616a896e-8354-4488-b5ca-fe750f6ec5e6]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248813]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-03 16:15:37.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[15]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-03 16:15:52.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d9021a02-1b81-4fd9-8eb8-74dfd394b1f3]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248865]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-05 08:48:42.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[13]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-05 08:48:55.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[dc17714e-8a9e-4730-a092-c5952b10fe4f]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[248866]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-10-05 08:50:15.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[14]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-10-05 08:50:29.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String"><![CDATA[ODI-1217: Session CASO_EXO_CALCULAR_STATS_CUENTAS (250210) fails with return code 20103.
ODI-1226: Step PRC_EXO_CALCULAR_STATS_CUENTAS fails after 1 attempt(s).
ODI-1232: Procedure PRC_EXO_CALCULAR_STATS_CUENTAS execution fails.
ODI-1228: Task Procedimiento-PRC_EXO_CALCULAR_STATS_CUENTAS-Calcular Estadisticos de Saldos de Cuentas fails on the target connection C_TRIBUTARIO.
Caused By: java.sql.SQLException: ORA-20103: Ocurrió un error al actualizar la información de cuentas con el saldo Final
ORA-06512: at line 176

	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:466)
	at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:407)
	at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1113)
	at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:546)
	at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:269)
	at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:603)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:218)
	at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:31)
	at oracle.jdbc.driver.T4CStatement.executeForRows(T4CStatement.java:1000)
	at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1316)
	at oracle.jdbc.driver.OracleStatement.executeInternal(OracleStatement.java:2168)
	at oracle.jdbc.driver.OracleStatement.execute(OracleStatement.java:2100)
	at oracle.jdbc.driver.OracleStatementWrapper.execute(OracleStatementWrapper.java:363)
	at oracle.odi.runtime.agent.execution.sql.SQLCommand.execute(SQLCommand.java:205)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:141)
	at oracle.odi.runtime.agent.execution.sql.SQLExecutor.execute(SQLExecutor.java:28)
	at oracle.odi.runtime.agent.execution.TaskExecutionHandler.handleTask(TaskExecutionHandler.java:52)
	at oracle.odi.runtime.agent.execution.SessionTask.processTask(SessionTask.java:206)
	at oracle.odi.runtime.agent.execution.SessionTask.doExecuteTask(SessionTask.java:117)
	at oracle.odi.runtime.agent.execution.AbstractSessionTask.execute(AbstractSessionTask.java:886)
	at oracle.odi.runtime.agent.execution.SessionExecutor$SerialTrain.runTasks(SessionExecutor.java:2227)
	at oracle.odi.runtime.agent.execution.SessionExecutor.executeSession(SessionExecutor.java:607)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:718)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor$1.doAction(TaskExecutorAgentRequestProcessor.java:611)
	at oracle.odi.core.persistence.dwgobject.DwgObjectTemplate.execute(DwgObjectTemplate.java:203)
	at oracle.odi.runtime.agent.processor.TaskExecutorAgentRequestProcessor.doProcessStartAgentTask(TaskExecutorAgentRequestProcessor.java:800)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor.access$2700(StartScenRequestProcessor.java:85)
	at oracle.odi.runtime.agent.processor.impl.StartScenRequestProcessor$StartScenTask.doExecute(StartScenRequestProcessor.java:917)
	at oracle.odi.runtime.agent.processor.task.AgentTask.execute(AgentTask.java:180)
	at oracle.odi.runtime.agent.support.DefaultAgentTaskExecutor$2.run(DefaultAgentTaskExecutor.java:108)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at oracle.odi.runtime.agent.execution.job.OdiJob.call(OdiJob.java:73)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[52b96b94-38f2-4ea7-9e58-c63ed03ae838]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[250210]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2022-11-30 10:37:34.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[1]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2022-11-30 10:37:35.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[20103]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[E]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenReport">
		<Field name="AgentName" type="java.lang.String"><![CDATA[OracleDIAgent]]></Field>
	<Field name="ContextCode" type="java.lang.String"><![CDATA[ODS_TRIBUTARIO]]></Field>
	<Field name="ErrorMessage" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[aee7696a-d6ac-4d59-b056-2205c4ecb3cb]]></Field>
	<Field name="ITxtSessMess" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbDel" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbErr" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbIns" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbMrg" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="NbRow" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="NbUpd" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenRunNo" type="com.sunopsis.sql.DbInt"><![CDATA[256475]]></Field>
	<Field name="SessBeg" type="java.sql.Timestamp"><![CDATA[2024-04-22 14:59:37.0]]></Field>
	<Field name="SessDur" type="com.sunopsis.sql.DbFloat"><![CDATA[4]]></Field>
	<Field name="SessEnd" type="java.sql.Timestamp"><![CDATA[2024-04-22 14:59:41.0]]></Field>
	<Field name="SessRc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="SessStatus" type="java.lang.String"><![CDATA[D]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpVarScen">
		<Field name="DefDate" type="java.sql.Timestamp">null</Field>
	<Field name="DefN" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="DefV" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fe5feb70-9829-46ae-95be-fe29759222e8]]></Field>
	<Field name="IndStore" type="java.lang.String"><![CDATA[S]]></Field>
	<Field name="ITxtDefT" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ITxtVar" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="VarDatatype" type="java.lang.String"><![CDATA[A]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String"><![CDATA[GLOBAL.VAR_PERIODO]]></Field>
	<Field name="VarParam" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="VarParamOrder" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenStep">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="CleanupOnError" type="java.lang.String">null</Field>
	<Field name="ContextCode" type="java.lang.String">null</Field>
	<Field name="FContextCode" type="java.lang.String">null</Field>
	<Field name="GenInfo" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[2cc1d1fd-d674-4806-8b0b-57af68f16bd3]]></Field>
	<Field name="IndLogMethod" type="java.lang.String"><![CDATA[Y]]></Field>
	<Field name="ITxtVarValue" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="JagentLschemaName" type="java.lang.String">null</Field>
	<Field name="KoExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="KoExitCode" type="java.lang.String">null</Field>
	<Field name="KoNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetry" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="KoRetryInterv" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="LschemaName" type="java.lang.String">null</Field>
	<Field name="MaxErr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="MaxErrPrct" type="java.lang.String">null</Field>
	<Field name="ModCode" type="java.lang.String">null</Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OkExit" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="OkExitCode" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="OkNextStep" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ResName" type="java.lang.String">null</Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="StepName" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="StepType" type="java.lang.String"><![CDATA[T]]></Field>
	<Field name="TableName" type="java.lang.String">null</Field>
	<Field name="VarIncr" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="VarLongValue" type="java.lang.String">null</Field>
	<Field name="VarName" type="java.lang.String">null</Field>
	<Field name="VarOp" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_nompart VARCHAR2(30);
  vl_SQL CLOB := '';
  vl_TablaTemp VARCHAR2(30) := 'WTMP_STATS_CUENTAS_SALDOS';
  vl_UltimaFec DATE;
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Movimientos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Sub_Producto VARCHAR2(4),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Ofi_Radicacion VARCHAR2(4),
    Saldo_Minimo NUMBER(26,2),
    Saldo_Maximo NUMBER(26,2),
    Mediana_Saldo NUMBER(26,2),
    Saldo_Promedio NUMBER(26,2));
    
  TYPE TabMvto IS TABLE OF t_Movimientos INDEX BY PLS_INTEGER;
  vl_tabmov TabMvto;
  
  FUNCTION f_hallar_particion(p_tabla VARCHAR2,
                              p_periodicidad VARCHAR2,
                              p_fecha DATE,
                              p_schema VARCHAR2) RETURN VARCHAR2 AS
    vl_nompart  VARCHAR2(50) := NULL;
    vl_parametro CLOB;
    vl_fecha    VARCHAR2(20):=NULL;
    
    CURSOR CurParticiones IS
    SELECT partition_name, high_value
    FROM ALL_TAB_PARTITIONS
    WHERE table_owner = p_schema
      AND table_name = UPPER(p_tabla);
  BEGIN
    IF p_periodicidad = 'A' THEN
      vl_fecha := '%' || TO_CHAR(ADD_MONTHS(p_fecha,12),'YYYY') || '%';
    ELSIF p_periodicidad = 'M' THEN
      vl_fecha := '%' || TO_CHAR(ADD_MONTHS(p_fecha,1),'YYYY-MM') || '%';
    ELSIF p_periodicidad = 'D' THEN
      vl_fecha := '%' || TO_CHAR(p_fecha + 1,'YYYY-MM-DD') || '%';
    END IF;

    FOR reg IN CurParticiones LOOP
      vl_parametro := reg.high_value;
      IF vl_parametro LIKE vl_fecha THEN
        vl_nompart:= reg.partition_name;
      END IF;
    END LOOP;

    RETURN  vl_nompart;
  END f_hallar_particion;
BEGIN
  BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<?=odiRef.getSchemaName("D") ?>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Sub_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Ofi_Radicacion VARCHAR2(4),
        Saldo_Final NUMBER(26,2),
        Saldo_Minimo NUMBER(26,2),
        Saldo_Maximo NUMBER(26,2),
        Mediana_Saldo NUMBER(26,2),
        Saldo_Promedio NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas de saldos.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<?=odiRef.getSchemaName("W") ?>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe > 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas de saldos para la fecha.');
      END;
    END IF;
  END IF;
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/ TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
           Cod_Producto,
           Sub_Producto,
           Cod_Cuenta,
           Tipo_Identificacion,
           Nro_Identificacion,
           ROUND(MAX(Ofi_Radicacion)),
           ROUND(MIN(Saldo_Corte)) Saldo_Minimo,
           ROUND(MAX(Saldo_Corte)) Saldo_Maximo,
           ROUND(MEDIAN(Saldo_Corte)) Mediana_Saldo,
           ROUND(AVG(Saldo_Corte)) Saldo_Promedio
    FROM <?=odiRef.getSchemaName("D") ?>.AH_SALDOS
    WHERE Periodo >= TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND 
          Periodo <= LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''))
      AND (Fecha_Cancel_M IS NULL OR
           Fecha_Cancel_M BETWEEN TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')
                              AND LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD'')))
    GROUP BY TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''),Cod_Producto, Sub_Producto, Cod_Cuenta,
             Tipo_Identificacion, Nro_Identificacion';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabmov LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabmov.Count
      EXECUTE IMMEDIATE '
        INSERT INTO /*+APPEND_VALUES*/ <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Sub_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion,
         Ofi_Radicacion,Saldo_Minimo, Saldo_Maximo, Mediana_Saldo, Saldo_Promedio)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11)'
      USING vl_tabmov(ind).Periodo, vl_tabmov(ind).Cod_Producto, vl_tabmov(ind).Sub_Producto, vl_tabmov(ind).Cod_Cuenta,
            vl_tabmov(ind).Tipo_Identificacion, vl_tabmov(ind).Nro_Identificacion, vl_tabmov(ind).Ofi_Radicacion,
            vl_tabmov(ind).Saldo_Minimo, vl_tabmov(ind).Saldo_Maximo, vl_tabmov(ind).Mediana_Saldo, vl_tabmov(ind).Saldo_Promedio;
      COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
  
  BEGIN
    EXECUTE IMMEDIATE '
      SELECT MAX(Periodo) FROM <?=odiRef.getSchemaName("D") ?>.AH_SALDOS
      WHERE PERIODO >= TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND
            PERIODO <= LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''))' INTO vl_UltimaFec;
			
  EXCEPTION WHEN OTHERS THEN vl_UltimaFec := NULL;
  END;
  
  vl_SQL := '
    MERGE INTO <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || ' w
    USING (SELECT Cod_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion, Saldo_Corte
           FROM <?=odiRef.getSchemaName("D") ?>.AH_SALDOS PARTITION FOR (TO_DATE(''' || TO_CHAR(vl_UltimaFec,'YYYYMMDD') || ''',''YYYYMMDD''))
           WHERE Fecha_Cancel_M IS NULL OR
                 Fecha_Cancel_M BETWEEN TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')
                                    AND LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD'')) ) tmp
    ON (w.periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND
        w.Cod_Producto = tmp.Cod_Producto AND 
	w.Cod_Cuenta = tmp.Cod_Cuenta AND
        w.Tipo_Identificacion = tmp.Tipo_Identificacion AND 
	w.Nro_Identificacion = tmp.Nro_Identificacion)
    WHEN MATCHED THEN
    UPDATE SET w.Saldo_Final = tmp.Saldo_Corte';
  
  BEGIN
    EXECUTE IMMEDIATE vl_SQL;
    COMMIT;
  EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20103,'Ocurrió un error al actualizar la información de cuentas con el saldo Final');
  END;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[366b76ab-0e8c-4d3a-af24-70bda2b6bc8e]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Calcular Estadisticos de Saldos de Cuentas]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[BEGIN

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_DEBITO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_DEBITO -- Creacion de la tabla temporal para la extraccion de informacion de debitos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,   
          TIPO_MOVIMIENTO               VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_CREDITO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_CREDITO -- Creacion de la tabla temporal para la extraccion de informacion de creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,   
          TIPO_MOVIMIENTO       VARCHAR2(4),
          MOTIVO_CONCEPTO       VARCHAR2(4),
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_DEBITO_CHE';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_DEBITO_CHE -- Creacion de la tabla temporal para la extraccion de informacion de debitos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO                  VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 		  
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_CREDITO_CHE';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_CREDITO_CHE -- Creacion de la tabla temporal para la extraccion de informacion de creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,     
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8)  ,
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITO_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITO_EXO -- Creacion de la tabla temporal para la extraccion de informacion de debitos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   , 
          TIPO_MOVIMIENTO                  VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2),   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_CREDITO_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_CREDITO_EXO -- Creacion de la tabla temporal para la extraccion de informacion de creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,    
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITO_CHE_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITO_CHE_EXO -- Creacion de la tabla temporal para la extraccion de informacion de debitos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO       VARCHAR2(4),
          MOTIVO_CONCEPTO       VARCHAR2(4),
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_CREDITO_CHE_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_CREDITO_CHE_EXO -- Creacion de la tabla temporal para la extraccion de informacion de creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,     
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITOS_CREDITOS CASCADE CONSTRAINTS';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITOS_CREDITOS -- Creacion de la tabla temporal para la union de debitos y creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;
   
   BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_CNTS_DEB_CRED ON WTMP_CUENTAS_DEBITOS_CREDITOS
            (
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            nro_transaccion,
            Rankeo
            )
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;


   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEB_CRED_CHEQ CASCADE CONSTRAINTS';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEB_CRED_CHEQ -- Creacion de la tabla temporal para la union de debitos y creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;
   
   BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_CNTS_DEB_CRED_CHEQ ON WTMP_CUENTAS_DEB_CRED_CHEQ
            (
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            nro_transaccion,
            Rankeo
            )
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;

   BEGIN
      BEGIN
         EXECUTE IMMEDIATE 'DROP TABLE WTMP_CNTS_DEB_CRED_EXCL_CHEQUE CASCADE CONSTRAINTS';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;

      BEGIN
         EXECUTE IMMEDIATE
          'CREATE TABLE WTMP_CNTS_DEB_CRED_EXCL_CHEQUE -- Creacion de la tabla temporal para la exclusión de cheques debito y credito
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)  ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
      
      BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_DEB_CRED_EXCL_EXO ON WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
            (PERIODO, COD_PRODUCTO, COD_CUENTA, TIPO_IDENTIFICACION, NRO_IDENTIFICACION)
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
	  BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_DEB_CRED_ESTADISTICOS ON WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
            (APL_EXOGENA)
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
   
   END;
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f8c4f161-afca-4e6c-a19f-f8e9074a7b22]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[2]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Crear tablas de movimientos Debito y Credito]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,  
   TIPO_MOVIMIENTO                  VARCHAR2(4),
   MOTIVO_CONCEPTO                  VARCHAR2(4), 
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_DEBITO_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
        SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos			
                TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                 ah.Motivo_Concepto,
                 ' || fn_verificar_exogena(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'DB') || ' Apl_Exogena, 
                 ''DB'' Naturaleza,
                 NULL Valor_CR,
                 ah.Valor_Total Valor_DB,
                 ah.nro_transac
				FROM <?=odiRef.getSchemaName("D") ?>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
						JOIN <?=odiRef.getSchemaName("D") ?>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
						LEFT JOIN (select Tipo_Identificacion,
                                                            Nro_Identificacion, 
                                                            cod_cuenta
                                                            from <?=odiRef.getSchemaName("D") ?>.WTMP_STATS_CUENTAS_SALDOS 
                                                            WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
                                                            
					WHERE tm.Operacion = 2
						AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fe2cef99-adf2-4224-976c-2060a5c11f1d]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[3]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_debito_exo]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2) ,   
   VALOR_DB             NUMBER(20,2) ,
   NRO_TRANSACCION      NUMBER(8)) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_CREDITO_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los credito		
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                 ah.Motivo_Concepto,
                 ' || fn_verificar_exogena(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'CR') || ' Apl_Exogena, 
                 ''CR'' Naturaleza,
                 ah.Valor_Total Valor_CR,
                 NULL Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0036'',''0035'',''0038'',''0039'') AND ah.Motivo_Concepto IN (''0000'') AND NVL( ah.Valor_Cheque,0) > 0 THEN -1
                 ELSE ah.nro_transac END nro_transac
                  FROM <?=odiRef.getSchemaName("D") ?>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                  JOIN <?=odiRef.getSchemaName("D") ?>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                  LEFT JOIN (select Tipo_Identificacion,
                                    Nro_Identificacion, 
                                    cod_cuenta
                                    from <?=odiRef.getSchemaName("D") ?>.WTMP_STATS_CUENTAS_SALDOS 
                                    WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
                    WHERE tm.Operacion = 1
                      AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[17e44df2-ab7d-4971-93a0-cf3ec2eac814]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[4]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_credito_exo]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4), 
   MOTIVO_CONCEPTO      VARCHAR2(4),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2) ,   
   VALOR_DB             NUMBER(20,2) ,
   NRO_TRANSACCION      NUMBER(8))   ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <?=odiRef.getSchemaName("D") ?>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_DEBITO_CHE_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO      ,
    MOTIVO_CONCEPTO      , 
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos			
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
				 ah.Tipo_Movimiento, 
				 ah.Motivo_Concepto, 
                 CASE WHEN ah.Cod_Producto IN (''0550'',''0560'',''0570'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0093'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0034'') AND ah.Motivo_Concepto IN (''0087'') THEN ''SI'' 
		 ELSE ''NO'' END Apl_Exogena,
                 ''DB'' Naturaleza,
                 NULL Valor_CR,
                 ah.Valor_Total Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN -1
                 ELSE ah.nro_transac END nro_transac
                    FROM <?=odiRef.getSchemaName("D") ?>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                    JOIN <?=odiRef.getSchemaName("D") ?>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                    LEFT JOIN (select Tipo_Identificacion,
                                      Nro_Identificacion, 
                                      cod_cuenta
                                      from <?=odiRef.getSchemaName("D") ?>.WTMP_STATS_CUENTAS_SALDOS 
                                      WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
			WHERE tm.Operacion = 2
                          AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[483ba186-fa6d-4edc-89ba-665ad7d0160f]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[5]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_debito_che_exo]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   , 
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8))   ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_CREDITO_CHE_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO      ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los creditos			
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                  ah.Motivo_Concepto,
                 CASE WHEN ah.Cod_Producto IN (''0550'',''0560'',''0570'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI''                  
                 WHEN ah.TIPO_MOVIMIENTO IN (''0048'') AND ah.Motivo_Concepto IN (''0000'') THEN ''SI''
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0093'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 ELSE ''NO'' END Apl_Exogena,
                 ''CR'' Naturaleza, 
                 ah.Valor_Total Valor_CR,
                 NULL Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN -1
                 ELSE ah.nro_transac END nro_transac
                    FROM <?=odiRef.getSchemaName("D") ?>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                    JOIN <?=odiRef.getSchemaName("D") ?>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                    LEFT JOIN (select Tipo_Identificacion,
                                      Nro_Identificacion, 
                                      cod_cuenta
                                      from <?=odiRef.getSchemaName("D") ?>.WTMP_STATS_CUENTAS_SALDOS 
                                      WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
			WHERE tm.Operacion = 2
			AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[3af44f53-a168-4cc3-9869-d821c9b7d5fa]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[6]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_credito_che_exo]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,   
   TIPO_MOVIMIENTO      VARCHAR2(4),
   MOTIVO_CONCEPTO      VARCHAR2(4), 
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   
begin   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_DEBITO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO              
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            TIPO_MOVIMIENTO     ,
            MOTIVO_CONCEPTO     ,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_DB, Nro_transaccion  ORDER BY Periodo,Valor_DB) Rankeo
		FROM WTMP_CUENTAS_DEBITO_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO     ,
                 vl_tab(i).MOTIVO_CONCEPTO     ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO               ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[58a169d2-c04a-4c30-bd07-f85332069493]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[7]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_debito]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_CREDITO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ 		
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento,
            Motivo_Concepto,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
		ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_CR, Nro_transaccion ORDER BY Periodo, Valor_CR) rankeo
                	FROM WTMP_CUENTAS_CREDITO_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO        ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO                ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[2c86771b-600f-41b4-9137-09128a8e16fc]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[80]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[8]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_credito]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4), 
   MOTIVO_CONCEPTO      VARCHAR2(4),   
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2)   ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_DEBITO_CHE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO      ,
    MOTIVO_CONCEPTO      , 
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
 	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ -- debitos a excluir
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento      ,
            Motivo_Concepto      , 
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_DB, Nro_transaccion ORDER BY Periodo, Valor_DB) Rankeo
			FROM WTMP_CUENTAS_DEBITO_CHE_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO		 ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
 END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[fbe66fb0-914e-46f5-8f72-68ae996a7824]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[9]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_debito_che]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
    MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

      
begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_CREDITO_CHE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
   MOTIVO_CONCEPTO      ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ -- debitos a excluir
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento,
            Motivo_Concepto,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_CR, Nro_transaccion ORDER BY Periodo, Valor_CR) Rankeo
		FROM WTMP_CUENTAS_CREDITO_CHE_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
                 vl_tab(i).RANKEO	         ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[aee8403f-e92a-4959-a49a-fd3c5435742f]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[100]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_credito_che]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql_creditos clob;
  vl_sql_debitos clob;
  type T_TABCAMPOS_CREDITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   type T_TABCAMPOS_DEBITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat_creditos IS TABLE OF T_TABCAMPOS_CREDITOS INDEX BY PLS_INTEGER;
   vl_tab_creditos t_tabdat_creditos;
   VL_CURSORSQL_CREDITOS SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;
   
   TYPE t_tabdat_debitos IS TABLE OF T_TABCAMPOS_DEBITOS INDEX BY PLS_INTEGER;
   vl_tab_debitos t_tabdat_debitos;
   VL_CURSORSQL_DEBITOS SYS_REFCURSOR;

      
BEGIN

    --------------------- CREDITOS --------------------

    BEGIN
        vl_sql_creditos := 
            'INSERT INTO WTMP_CUENTAS_DEBITOS_CREDITOS
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_CREDITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_CREDITO';
                                
            
            LOOP
            FETCH VL_CURSORSQL_CREDITOS BULK COLLECT INTO vl_tab_creditos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_creditos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_creditos(i).PERIODO               ,
                        vl_tab_creditos(i).COD_PRODUCTO          ,
                        vl_tab_creditos(i).COD_CUENTA            ,
                        vl_tab_creditos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_creditos(i).NRO_IDENTIFICACION    ,
                        vl_tab_creditos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_creditos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_creditos(i).APL_EXOGENA           ,
                        vl_tab_creditos(i).NATURALEZA            ,
                        vl_tab_creditos(i).VALOR_CR              ,
                        vl_tab_creditos(i).VALOR_DB              ,
                        vl_tab_creditos(i).NRO_TRANSACCION       ,
                        vl_tab_creditos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_CREDITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_CREDITOS;    
    END;
    
    --------------------- DEBITOS --------------------
    
    BEGIN
        vl_sql_debitos := 
            'INSERT INTO WTMP_CUENTAS_DEBITOS_CREDITOS
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_DEBITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_DEBITO';
                                
            
            LOOP
            FETCH VL_CURSORSQL_DEBITOS BULK COLLECT INTO vl_tab_debitos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_debitos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_debitos(i).PERIODO               ,
                        vl_tab_debitos(i).COD_PRODUCTO          ,
                        vl_tab_debitos(i).COD_CUENTA            ,
                        vl_tab_debitos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_debitos(i).NRO_IDENTIFICACION    ,
                        vl_tab_debitos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_debitos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_debitos(i).APL_EXOGENA           ,
                        vl_tab_debitos(i).NATURALEZA            ,
                        vl_tab_debitos(i).VALOR_CR              ,
                        vl_tab_debitos(i).VALOR_DB              ,
                        vl_tab_debitos(i).NRO_TRANSACCION       ,
                        vl_tab_debitos(i).RANKEO                ;
                        commit;
            EXIT WHEN VL_CURSORSQL_DEBITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_DEBITOS;    
    END;  
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[80c29d56-fe7d-4e5a-818f-42afcff82680]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[110]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[11]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Union debitos y creditos exogena]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql_creditos clob;
  vl_sql_debitos clob;
  type T_TABCAMPOS_CREDITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   type T_TABCAMPOS_DEBITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat_creditos IS TABLE OF T_TABCAMPOS_CREDITOS INDEX BY PLS_INTEGER;
   vl_tab_creditos t_tabdat_creditos;
   VL_CURSORSQL_CREDITOS SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;
   
   TYPE t_tabdat_debitos IS TABLE OF T_TABCAMPOS_DEBITOS INDEX BY PLS_INTEGER;
   vl_tab_debitos t_tabdat_debitos;
   VL_CURSORSQL_DEBITOS SYS_REFCURSOR;

      
BEGIN

    --------------------- CREDITOS --------------------

    BEGIN
        vl_sql_creditos := 
            'INSERT INTO WTMP_CUENTAS_DEB_CRED_CHEQ
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_CREDITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_CREDITO_CHE';
                                
            
            LOOP
            FETCH VL_CURSORSQL_CREDITOS BULK COLLECT INTO vl_tab_creditos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_creditos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_creditos(i).PERIODO               ,
                        vl_tab_creditos(i).COD_PRODUCTO          ,
                        vl_tab_creditos(i).COD_CUENTA            ,
                        vl_tab_creditos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_creditos(i).NRO_IDENTIFICACION    ,
                        vl_tab_creditos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_creditos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_creditos(i).APL_EXOGENA           ,
                        vl_tab_creditos(i).NATURALEZA            ,
                        vl_tab_creditos(i).VALOR_CR              ,
                        vl_tab_creditos(i).VALOR_DB              ,
                        vl_tab_creditos(i).NRO_TRANSACCION       ,
                        vl_tab_creditos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_CREDITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_CREDITOS;    
    END;
    
    --------------------- DEBITOS --------------------
    
    BEGIN
        vl_sql_debitos := 
            'INSERT INTO WTMP_CUENTAS_DEB_CRED_CHEQ
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_DEBITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_DEBITO_CHE';
                                
            
            LOOP
            FETCH VL_CURSORSQL_DEBITOS BULK COLLECT INTO vl_tab_debitos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_debitos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_debitos(i).PERIODO               ,
                        vl_tab_debitos(i).COD_PRODUCTO          ,
                        vl_tab_debitos(i).COD_CUENTA            ,
                        vl_tab_debitos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_debitos(i).NRO_IDENTIFICACION    ,
                        vl_tab_debitos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_debitos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_debitos(i).APL_EXOGENA           ,
                        vl_tab_debitos(i).NATURALEZA            ,
                        vl_tab_debitos(i).VALOR_CR              ,
                        vl_tab_debitos(i).VALOR_DB              ,
                        vl_tab_debitos(i).NRO_TRANSACCION       ,
                        vl_tab_debitos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_DEBITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_DEBITOS;    
    END;  
END;
]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[c0471b0a-fe6a-452d-bc6a-9d8c010f32e4]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[120]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[12]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Union debitos y creditos cheques]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO        NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 10000;
      
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
    open VL_CURSORSQL for '
    SELECT /*+PARALLEL(8)*/ -- Minus lógico
            CDC.Periodo,
            CDC.Cod_Producto,
            CDC.Cod_Cuenta,
            CDC.Tipo_Identificacion,
            CDC.Nro_Identificacion,
            CDC.Tipo_movimiento,
            CDC.Motivo_concepto,
            CDC.Apl_Exogena,
            CDC.Naturaleza,
            CDC.Valor_CR,
            CDC.Valor_DB,
            CDC.nro_transaccion,
            CDC.Rankeo
                FROM WTMP_CUENTAS_DEBITOS_CREDITOS CDC LEFT JOIN WTMP_CUENTAS_DEB_CRED_CHEQ CDCC
                ON  
                (
                CDC.Periodo = CDCC.Periodo and
                CDC.Cod_Producto = CDCC.Cod_Producto and
                CDC.Cod_Cuenta = CDCC.Cod_Cuenta and
                CDC.Tipo_Identificacion = CDCC.Tipo_Identificacion and
                CDC.Nro_Identificacion = CDCC.Nro_Identificacion and
                CDC.Apl_Exogena = CDCC.Apl_Exogena and
                CDC.Naturaleza = CDCC.Naturaleza and
                NVL(CDC.Valor_CR,-1) = NVL(CDCC.Valor_CR,-1) and
                NVL(CDC.Valor_DB,-1) = NVL(CDCC.Valor_DB,-1) and
                CDC.nro_transaccion = CDCC.nro_transaccion and
                CDC.Rankeo = CDCC.Rankeo
                )
                WHERE
                CDCC.Periodo IS NULL';
  
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
             vl_tab(i).PERIODO                   ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
                 vl_tab(i).RANKEO                 ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[eb5a083c-fef6-488c-b9c4-c02d1d930792]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[130]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[13]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[minus logico debitos y creditos, exogena y cheques]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_SQL CLOB := '';
  
BEGIN
  vl_SQL := '
    MERGE INTO WTMP_CNTS_DEB_CRED_EXCL_CHEQUE  TMP_FINAL
    USING (
	SELECT 
	TMP1.PERIODO    	    ,    
	TMP1.COD_PRODUCTO           ,
	TMP1.COD_CUENTA             ,
	TMP1.TIPO_IDENTIFICACION    ,
	TMP1.NRO_IDENTIFICACION     ,
	TMP1.TIPO_MOVIMIENTO        ,
	TMP1.MOTIVO_CONCEPTO        ,
	TMP1.APL_EXOGENA            ,
	TMP1.NATURALEZA             ,
	TMP1.VALOR_CR               ,
	TMP1.VALOR_DB               ,
	TMP1.NRO_TRANSAC            ,
	TMP1.REFERENCIA_2			,
	ROW_NUMBER() OVER (PARTITION BY trunc(TMP1.Periodo,''mm''), TMP1.Naturaleza, TMP1.cod_cuenta, TMP1.Valor_CR, TMP1.Valor_DB, TMP1.Nro_transac  ORDER BY TMP1.Periodo) AS RANKEO
	FROM <?=odiRef.getSchemaName("D") ?>.WTMP_EXCL_MVTOS_MISMO_TITULAR TMP1
	)w
	ON(
	TMP_FINAL.TIPO_IDENTIFICACION	= w.TIPO_IDENTIFICACION AND
	TMP_FINAL.NRO_IDENTIFICACION 	= w.NRO_IDENTIFICACION   AND 
	TMP_FINAL.COD_CUENTA		= w.COD_CUENTA AND 
	TMP_FINAL.TIPO_MOVIMIENTO 	= w.TIPO_MOVIMIENTO AND 
	TMP_FINAL.MOTIVO_CONCEPTO 	= w.MOTIVO_CONCEPTO AND 
	TMP_FINAL.NATURALEZA 		= w.NATURALEZA AND
	NVL(TMP_FINAL.VALOR_CR,-1) 	= NVL(w.VALOR_CR,-1) AND 
	NVL(TMP_FINAL.VALOR_DB,-1) 	= NVL(w.VALOR_DB,-1) AND 
	TMP_FINAL.NRO_TRANSACCION	= w.NRO_TRANSAC AND
	TMP_FINAL.RANKEO 		= w.RANKEO
	)
	WHEN MATCHED THEN 
	UPDATE SET TMP_FINAL.APL_EXOGENA = w.APL_EXOGENA';
	
  BEGIN
    EXECUTE IMMEDIATE vl_SQL;
	COMMIT;
--	EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20103,'Ocurrió un error al actualizar la exclusión para movimientos del mismo titular');
  END;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[452cccce-fcaa-4ebf-98e6-2343898aa1a0]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[14]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Excluir Movimientos del mismo titular]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_nompart VARCHAR2(30);
  vl_SQL CLOB := '';
  vl_TablaTemp VARCHAR2(30) := 'WTMP_STATS_CUENTAS_MOVTOS';
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Movimientos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Cantidad_CR NUMBER(15),
    Valor_CR NUMBER(26,2),
    Promedio_CR NUMBER(26,2),
    Mediana_CR NUMBER(26,2),
    Cantidad_DB NUMBER(15),
    Valor_DB NUMBER(26,2),
    Promedio_DB NUMBER(26,2),
    Mediana_DB NUMBER(26,2));
    
  TYPE TabMvto IS TABLE OF t_Movimientos INDEX BY PLS_INTEGER;
  vl_tabmov TabMvto;
  
BEGIN
  BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<?=odiRef.getSchemaName("D") ?>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Cantidad_CR NUMBER(15),
        Valor_CR NUMBER(26,2),
        Promedio_CR NUMBER(26,2),
        Mediana_CR NUMBER(26,2),
        Cantidad_DB NUMBER(15),
        Valor_DB NUMBER(26,2),
        Promedio_DB NUMBER(26,2),
        Mediana_DB NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<?=odiRef.getSchemaName("W") ?>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe <> 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas para la fecha.');
      END;
    END IF;
  END IF;  
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/
		   tx.Periodo,
           tx.Cod_Producto,
           tx.Cod_Cuenta,
           tx.Tipo_Identificacion,
           tx.Nro_Identificacion,
		   SUM( CASE WHEN NATURALEZA=''CR'' THEN 1 ELSE 0 END) CANTIDAD_CR,
		   ROUND(SUM(NVL(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END,0))) VALOR_CR,
		   ROUND(AVG(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END)) PROMEDIO_CR,
		   ROUND(MEDIAN(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END)) MEDIANA_CR,
		   SUM( CASE WHEN NATURALEZA=''DB'' THEN 1 ELSE 0 END) CANTIDAD_DB,
		   ROUND(SUM(NVL(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END,0))) VALOR_DB,
		   ROUND(AVG(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END)) PROMEDIO_DB,
		   ROUND(MEDIAN(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END)) MEDIANA_DB
    FROM  WTMP_CNTS_DEB_CRED_EXCL_CHEQUE tx
    WHERE tx.Apl_Exogena = ''SI''
    GROUP BY tx.Periodo,
			 tx.Cod_Producto,
                         tx.Cod_Cuenta, 
			 tx.Tipo_Identificacion, 
			 tx.Nro_Identificacion';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabmov LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabmov.Count
      EXECUTE IMMEDIATE '
        INSERT /*+APPEND_VALUES*/ INTO <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion, Cantidad_CR,
         Valor_CR, Promedio_CR, Mediana_CR, Cantidad_DB, Valor_DB, Promedio_DB, Mediana_DB)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13)'
      USING vl_tabmov(ind).Periodo, vl_tabmov(ind).Cod_Producto, vl_tabmov(ind).Cod_Cuenta, vl_tabmov(ind).Tipo_Identificacion,
            vl_tabmov(ind).Nro_Identificacion, vl_tabmov(ind).Cantidad_CR, vl_tabmov(ind).Valor_CR, vl_tabmov(ind).Promedio_CR, 
            vl_tabmov(ind).Mediana_CR, vl_tabmov(ind).Cantidad_DB, vl_tabmov(ind).Valor_DB, vl_tabmov(ind).Promedio_DB,
            vl_tabmov(ind).Mediana_DB;
      COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
  
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[5d1b71b9-0692-4e56-8ef5-1b377defdda8]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[150]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[15]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Calcular Estadisticos de Movimientos de Cuentas]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpScenTask">
		<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColEncKey" type="java.lang.String">null</Field>
	<Field name="ColEncKeyVect" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIndEnc" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="ColTxt" type="java.lang.String">null</Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefEncKey" type="java.lang.String">null</Field>
	<Field name="DefEncKeyVect" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIndEnc" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechIntName" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefTxt" type="java.lang.String"><![CDATA[DECLARE
  vl_SQL CLOB := '';
  
  vl_TablaTemp    VARCHAR2(30) := 'WTMP_STATS_CUENTAS';
  vl_TablaTempSal VARCHAR2(30) := 'WTMP_STATS_CUENTAS_SALDOS';
  vl_TablaTempMov VARCHAR2(30) := 'WTMP_STATS_CUENTAS_MOVTOS';
  
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Estadisticos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Sub_Producto VARCHAR2(4 CHAR),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Ofi_Radicacion VARCHAR2(4),
    Saldo_Final NUMBER(26,2),
    Saldo_Minimo NUMBER(26,2),
    Saldo_Maximo NUMBER(26,2),
    Mediana_Saldo NUMBER(26,2),
    Saldo_Promedio NUMBER(26,2),
    Cantidad_CR NUMBER(15),
    Valor_CR NUMBER(26,2),
    Promedio_CR NUMBER(26,2),
    Mediana_CR NUMBER(26,2),
    Cantidad_DB NUMBER(15),
    Valor_DB NUMBER(26,2),
    Promedio_DB NUMBER(26,2),
    Mediana_DB NUMBER(26,2));
    
  TYPE TabStats IS TABLE OF t_Estadisticos INDEX BY PLS_INTEGER;
  vl_tabstats TabStats;
BEGIN
    BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<?=odiRef.getSchemaName("D") ?>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Sub_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Ofi_Radicacion VARCHAR2(4),
        Saldo_Final NUMBER(26,2),
        Saldo_Minimo NUMBER(26,2),
        Saldo_Maximo NUMBER(26,2),
        Mediana_Saldo NUMBER(26,2),
        Saldo_Promedio NUMBER(26,2),
        Cantidad_CR NUMBER(15),
        Valor_CR NUMBER(26,2),
        Promedio_CR NUMBER(26,2),
        Mediana_CR NUMBER(26,2),
        Cantidad_DB NUMBER(15),
        Valor_DB NUMBER(26,2),
        Promedio_DB NUMBER(26,2),
        Mediana_DB NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas de saldos.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<?=odiRef.getSchemaName("W") ?>');
    <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<?=odiRef.getSchemaName("W") ?>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe <> 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <?=odiRef.getSchemaName("D") ?>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<?=odiRef.getSchemaName("W") ?>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas de saldos para la fecha.');
      END;
    END IF;
  END IF;
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/ ahs.Periodo, ahs.Cod_Producto, ahs.Sub_Producto, ahs.Cod_Cuenta, ahs.Tipo_Identificacion,
           ahs.Nro_Identificacion, ahs.Ofi_Radicacion, ahs.Saldo_Final, ahs.Saldo_Minimo, ahs.Saldo_Maximo, ahs.Mediana_Saldo,
           ahs.Saldo_Promedio, ahm.Cantidad_CR, ahm.Valor_CR, ahm.Promedio_CR, ahm.Mediana_CR, ahm.Cantidad_DB,
           ahm.Valor_DB, ahm.Promedio_DB, ahm.Mediana_DB
    FROM <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTempSal || ' PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) ahs
    LEFT JOIN <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTempMov || ' PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) ahm
    ON (ahs.Periodo = ahm.Periodo AND
        ahs.Cod_Producto = ahm.Cod_Producto AND ahs.Cod_Cuenta = ahm.Cod_Cuenta AND
        ahs.Tipo_Identificacion = ahm.Tipo_Identificacion AND ahs.Nro_Identificacion = ahm.Nro_Identificacion)';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabstats LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabstats.Count
      EXECUTE IMMEDIATE '
        INSERT /*+APPEND_VALUES*/ INTO <?=odiRef.getSchemaName("D") ?>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Sub_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion,
         Ofi_Radicacion, Saldo_Final, Saldo_Minimo, Saldo_Maximo, Mediana_Saldo, Saldo_Promedio,
         Cantidad_CR, Valor_CR, Promedio_CR, Mediana_CR, Cantidad_DB, Valor_DB, Promedio_DB, Mediana_DB)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17, :18, :19, :20)'
      USING vl_tabstats(ind).Periodo, vl_tabstats(ind).Cod_Producto, vl_tabstats(ind).Sub_Producto, vl_tabstats(ind).Cod_Cuenta,
            vl_tabstats(ind).Tipo_Identificacion, vl_tabstats(ind).Nro_Identificacion, vl_tabstats(ind).Ofi_Radicacion,
            vl_tabstats(ind).Saldo_Final, vl_tabstats(ind).Saldo_Minimo, vl_tabstats(ind).Saldo_Maximo, vl_tabstats(ind).Mediana_Saldo,
            vl_tabstats(ind).Saldo_Promedio, vl_tabstats(ind).Cantidad_CR, vl_tabstats(ind).Valor_CR, vl_tabstats(ind).Promedio_CR,
            vl_tabstats(ind).Mediana_CR, vl_tabstats(ind).Cantidad_DB, vl_tabstats(ind).Valor_DB, vl_tabstats(ind).Promedio_DB,
            vl_tabstats(ind).Mediana_DB;
    COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
END;]]></Field>
	<Field name="ExeChannel" type="java.lang.String"><![CDATA[J]]></Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f32e9ba0-a836-468e-9011-de2f3a7f3099]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="Nno" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[160]]></Field>
	<Field name="ParScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ScenNo" type="com.sunopsis.sql.DbInt"><![CDATA[7425]]></Field>
	<Field name="ScenTaskNo" type="com.sunopsis.sql.DbInt"><![CDATA[16]]></Field>
	<Field name="TaskName1" type="java.lang.String"><![CDATA[Procedimiento]]></Field>
	<Field name="TaskName2" type="java.lang.String"><![CDATA[PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
	<Field name="TaskName3" type="java.lang.String"><![CDATA[Generar las cuentas con todos los Estadisticos]]></Field>
	<Field name="TaskType" type="java.lang.String"><![CDATA[S]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16351]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[ec4ebc2f-7e31-4c7e-b1e2-a91e14acb8bf]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[4115]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[150]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Calcular Estadisticos de Movimientos de Cuentas]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[e7e489d8-a18a-42ce-a92c-52268bb42e88]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16351]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_nompart VARCHAR2(30);
  vl_SQL CLOB := '';
  vl_TablaTemp VARCHAR2(30) := 'WTMP_STATS_CUENTAS_MOVTOS';
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Movimientos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Cantidad_CR NUMBER(15),
    Valor_CR NUMBER(26,2),
    Promedio_CR NUMBER(26,2),
    Mediana_CR NUMBER(26,2),
    Cantidad_DB NUMBER(15),
    Valor_DB NUMBER(26,2),
    Promedio_DB NUMBER(26,2),
    Mediana_DB NUMBER(26,2));
    
  TYPE TabMvto IS TABLE OF t_Movimientos INDEX BY PLS_INTEGER;
  vl_tabmov TabMvto;
  
BEGIN
  BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<%=odiRef.getSchemaName( "D" )%>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Cantidad_CR NUMBER(15),
        Valor_CR NUMBER(26,2),
        Promedio_CR NUMBER(26,2),
        Mediana_CR NUMBER(26,2),
        Cantidad_DB NUMBER(15),
        Valor_DB NUMBER(26,2),
        Promedio_DB NUMBER(26,2),
        Mediana_DB NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<%=odiRef.getSchemaName( "W" )%>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe <> 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas para la fecha.');
      END;
    END IF;
  END IF;  
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/
		   tx.Periodo,
           tx.Cod_Producto,
           tx.Cod_Cuenta,
           tx.Tipo_Identificacion,
           tx.Nro_Identificacion,
		   SUM( CASE WHEN NATURALEZA=''CR'' THEN 1 ELSE 0 END) CANTIDAD_CR,
		   ROUND(SUM(NVL(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END,0))) VALOR_CR,
		   ROUND(AVG(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END)) PROMEDIO_CR,
		   ROUND(MEDIAN(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_CR END)) MEDIANA_CR,
		   SUM( CASE WHEN NATURALEZA=''DB'' THEN 1 ELSE 0 END) CANTIDAD_DB,
		   ROUND(SUM(NVL(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END,0))) VALOR_DB,
		   ROUND(AVG(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END)) PROMEDIO_DB,
		   ROUND(MEDIAN(CASE WHEN TIPO_MOVIMIENTO = ''0055'' AND MOTIVO_CONCEPTO = ''0001'' THEN 0 ELSE VALOR_DB END)) MEDIANA_DB
    FROM  WTMP_CNTS_DEB_CRED_EXCL_CHEQUE tx
    WHERE tx.Apl_Exogena = ''SI''
    GROUP BY tx.Periodo,
			 tx.Cod_Producto,
                         tx.Cod_Cuenta, 
			 tx.Tipo_Identificacion, 
			 tx.Nro_Identificacion';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabmov LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabmov.Count
      EXECUTE IMMEDIATE '
        INSERT /*+APPEND_VALUES*/ INTO <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion, Cantidad_CR,
         Valor_CR, Promedio_CR, Mediana_CR, Cantidad_DB, Valor_DB, Promedio_DB, Mediana_DB)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13)'
      USING vl_tabmov(ind).Periodo, vl_tabmov(ind).Cod_Producto, vl_tabmov(ind).Cod_Cuenta, vl_tabmov(ind).Tipo_Identificacion,
            vl_tabmov(ind).Nro_Identificacion, vl_tabmov(ind).Cantidad_CR, vl_tabmov(ind).Valor_CR, vl_tabmov(ind).Promedio_CR, 
            vl_tabmov(ind).Mediana_CR, vl_tabmov(ind).Cantidad_DB, vl_tabmov(ind).Valor_DB, vl_tabmov(ind).Promedio_DB,
            vl_tabmov(ind).Mediana_DB;
      COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
  
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpOrigTxt">
		<Field name="GlobalId" type="java.lang.String">null</Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="OrigineName" type="java.lang.String"><![CDATA[Tecnología de Destino]]></Field>
	<Field name="SnpsCol" type="java.lang.String"><![CDATA[DEF_I_TXT]]></Field>
	<Field name="SnpsTable" type="java.lang.String"><![CDATA[SNP_LINE_TRT]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16352]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[e7580370-dffd-4d88-9e05-94ae9dc952d3]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[4116]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Calcular Estadisticos de Saldos de Cuentas]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[188e7166-f760-48f7-92f5-f67c2ffce7b7]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16352]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_nompart VARCHAR2(30);
  vl_SQL CLOB := '';
  vl_TablaTemp VARCHAR2(30) := 'WTMP_STATS_CUENTAS_SALDOS';
  vl_UltimaFec DATE;
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Movimientos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Sub_Producto VARCHAR2(4),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Ofi_Radicacion VARCHAR2(4),
    Saldo_Minimo NUMBER(26,2),
    Saldo_Maximo NUMBER(26,2),
    Mediana_Saldo NUMBER(26,2),
    Saldo_Promedio NUMBER(26,2));
    
  TYPE TabMvto IS TABLE OF t_Movimientos INDEX BY PLS_INTEGER;
  vl_tabmov TabMvto;
  
  FUNCTION f_hallar_particion(p_tabla VARCHAR2,
                              p_periodicidad VARCHAR2,
                              p_fecha DATE,
                              p_schema VARCHAR2) RETURN VARCHAR2 AS
    vl_nompart  VARCHAR2(50) := NULL;
    vl_parametro CLOB;
    vl_fecha    VARCHAR2(20):=NULL;
    
    CURSOR CurParticiones IS
    SELECT partition_name, high_value
    FROM ALL_TAB_PARTITIONS
    WHERE table_owner = p_schema
      AND table_name = UPPER(p_tabla);
  BEGIN
    IF p_periodicidad = 'A' THEN
      vl_fecha := '%' || TO_CHAR(ADD_MONTHS(p_fecha,12),'YYYY') || '%';
    ELSIF p_periodicidad = 'M' THEN
      vl_fecha := '%' || TO_CHAR(ADD_MONTHS(p_fecha,1),'YYYY-MM') || '%';
    ELSIF p_periodicidad = 'D' THEN
      vl_fecha := '%' || TO_CHAR(p_fecha + 1,'YYYY-MM-DD') || '%';
    END IF;

    FOR reg IN CurParticiones LOOP
      vl_parametro := reg.high_value;
      IF vl_parametro LIKE vl_fecha THEN
        vl_nompart:= reg.partition_name;
      END IF;
    END LOOP;

    RETURN  vl_nompart;
  END f_hallar_particion;
BEGIN
  BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<%=odiRef.getSchemaName( "D" )%>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Sub_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Ofi_Radicacion VARCHAR2(4),
        Saldo_Final NUMBER(26,2),
        Saldo_Minimo NUMBER(26,2),
        Saldo_Maximo NUMBER(26,2),
        Mediana_Saldo NUMBER(26,2),
        Saldo_Promedio NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas de saldos.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<%=odiRef.getSchemaName( "W" )%>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe > 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas de saldos para la fecha.');
      END;
    END IF;
  END IF;
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/ TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
           Cod_Producto,
           Sub_Producto,
           Cod_Cuenta,
           Tipo_Identificacion,
           Nro_Identificacion,
           ROUND(MAX(Ofi_Radicacion)),
           ROUND(MIN(Saldo_Corte)) Saldo_Minimo,
           ROUND(MAX(Saldo_Corte)) Saldo_Maximo,
           ROUND(MEDIAN(Saldo_Corte)) Mediana_Saldo,
           ROUND(AVG(Saldo_Corte)) Saldo_Promedio
    FROM <%=odiRef.getSchemaName( "D" )%>.AH_SALDOS
    WHERE Periodo >= TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND 
          Periodo <= LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''))
      AND (Fecha_Cancel_M IS NULL OR
           Fecha_Cancel_M BETWEEN TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')
                              AND LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD'')))
    GROUP BY TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''),Cod_Producto, Sub_Producto, Cod_Cuenta,
             Tipo_Identificacion, Nro_Identificacion';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabmov LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabmov.Count
      EXECUTE IMMEDIATE '
        INSERT INTO /*+APPEND_VALUES*/ <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Sub_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion,
         Ofi_Radicacion,Saldo_Minimo, Saldo_Maximo, Mediana_Saldo, Saldo_Promedio)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11)'
      USING vl_tabmov(ind).Periodo, vl_tabmov(ind).Cod_Producto, vl_tabmov(ind).Sub_Producto, vl_tabmov(ind).Cod_Cuenta,
            vl_tabmov(ind).Tipo_Identificacion, vl_tabmov(ind).Nro_Identificacion, vl_tabmov(ind).Ofi_Radicacion,
            vl_tabmov(ind).Saldo_Minimo, vl_tabmov(ind).Saldo_Maximo, vl_tabmov(ind).Mediana_Saldo, vl_tabmov(ind).Saldo_Promedio;
      COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
  
  BEGIN
    EXECUTE IMMEDIATE '
      SELECT MAX(Periodo) FROM <%=odiRef.getSchemaName( "D" )%>.AH_SALDOS
      WHERE PERIODO >= TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND
            PERIODO <= LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''))' INTO vl_UltimaFec;
			
  EXCEPTION WHEN OTHERS THEN vl_UltimaFec := NULL;
  END;
  
  vl_SQL := '
    MERGE INTO <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || ' w
    USING (SELECT Cod_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion, Saldo_Corte
           FROM <%=odiRef.getSchemaName( "D" )%>.AH_SALDOS PARTITION FOR (TO_DATE(''' || TO_CHAR(vl_UltimaFec,'YYYYMMDD') || ''',''YYYYMMDD''))
           WHERE Fecha_Cancel_M IS NULL OR
                 Fecha_Cancel_M BETWEEN TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')
                                    AND LAST_DAY(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD'')) ) tmp
    ON (w.periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') AND
        w.Cod_Producto = tmp.Cod_Producto AND 
	w.Cod_Cuenta = tmp.Cod_Cuenta AND
        w.Tipo_Identificacion = tmp.Tipo_Identificacion AND 
	w.Nro_Identificacion = tmp.Nro_Identificacion)
    WHEN MATCHED THEN
    UPDATE SET w.Saldo_Final = tmp.Saldo_Corte';
  
  BEGIN
    EXECUTE IMMEDIATE vl_SQL;
    COMMIT;
  EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20103,'Ocurrió un error al actualizar la información de cuentas con el saldo Final');
  END;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16359]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[2d93599f-f878-48a2-a35b-6a6e4c33f308]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[4120]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[160]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Generar las cuentas con todos los Estadisticos]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[eff6ad0a-b5e1-4355-91b3-db0702cc288a]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[16359]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_SQL CLOB := '';
  
  vl_TablaTemp    VARCHAR2(30) := 'WTMP_STATS_CUENTAS';
  vl_TablaTempSal VARCHAR2(30) := 'WTMP_STATS_CUENTAS_SALDOS';
  vl_TablaTempMov VARCHAR2(30) := 'WTMP_STATS_CUENTAS_MOVTOS';
  
  vl_Existe PLS_INTEGER;
  vl_CursorSQL SYS_REFCURSOR;
  Cr_Limit_Bulk NATURAL DEFAULT 10000;
  
  TYPE t_Estadisticos IS RECORD (
    Periodo DATE,
    Cod_Producto VARCHAR2(4 CHAR),
    Sub_Producto VARCHAR2(4 CHAR),
    Cod_Cuenta VARCHAR2(16 CHAR),
    Tipo_Identificacion VARCHAR2(2 CHAR),
    Nro_Identificacion NUMBER(16),
    Ofi_Radicacion VARCHAR2(4),
    Saldo_Final NUMBER(26,2),
    Saldo_Minimo NUMBER(26,2),
    Saldo_Maximo NUMBER(26,2),
    Mediana_Saldo NUMBER(26,2),
    Saldo_Promedio NUMBER(26,2),
    Cantidad_CR NUMBER(15),
    Valor_CR NUMBER(26,2),
    Promedio_CR NUMBER(26,2),
    Mediana_CR NUMBER(26,2),
    Cantidad_DB NUMBER(15),
    Valor_DB NUMBER(26,2),
    Promedio_DB NUMBER(26,2),
    Mediana_DB NUMBER(26,2));
    
  TYPE TabStats IS TABLE OF t_Estadisticos INDEX BY PLS_INTEGER;
  vl_tabstats TabStats;
BEGIN
    BEGIN
    -- Verifica si existe la tabla temporal de trabajo de movimientos
    EXECUTE IMMEDIATE 'SELECT NVL(COUNT(1),0) FROM ALL_TABLES WHERE OWNER = ''<%=odiRef.getSchemaName( "D" )%>'' AND TABLE_NAME = ''' || vl_TablaTemp || ''''
    INTO vl_Existe;
  EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
  END;
  
  IF vl_Existe = 0 THEN
    -- Creación de la tabla temporal de trabajo de movimientos
    vl_SQL := '
      CREATE TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '(
        Periodo DATE,
        Cod_Producto VARCHAR2(4 CHAR),
        Sub_Producto VARCHAR2(4 CHAR),
        Cod_Cuenta VARCHAR2(16 CHAR),
        Tipo_Identificacion VARCHAR2(2 CHAR),
        Nro_Identificacion NUMBER(16),
        Ofi_Radicacion VARCHAR2(4),
        Saldo_Final NUMBER(26,2),
        Saldo_Minimo NUMBER(26,2),
        Saldo_Maximo NUMBER(26,2),
        Mediana_Saldo NUMBER(26,2),
        Saldo_Promedio NUMBER(26,2),
        Cantidad_CR NUMBER(15),
        Valor_CR NUMBER(26,2),
        Promedio_CR NUMBER(26,2),
        Mediana_CR NUMBER(26,2),
        Cantidad_DB NUMBER(15),
        Valor_DB NUMBER(26,2),
        Promedio_DB NUMBER(26,2),
        Mediana_DB NUMBER(26,2)
      ) TABLESPACE LA_STG_DATOS
      PARTITION BY RANGE (Periodo) INTERVAL (NUMTOYMINTERVAL(1,''MONTH''))
      (PARTITION P1_WTMPCTASTAT VALUES LESS THAN (TO_DATE(''20161201'',''YYYYMMDD'')) TABLESPACE LA_STG_DATOS)';
    
    BEGIN
      <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
    EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20101,'Ocurrió un error al crear la tabla de trabajo de estadisticos de cuentas de saldos.');
    END;
    
    --Asignar permisos a la tabla temporal de trabajo de movimientos
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'SELECT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'INSERT','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'UPDATE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp,'DELETE','<%=odiRef.getSchemaName( "W" )%>');
    <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_ASIGNAR_PERMISO(vl_TablaTemp, 'ALTER','<%=odiRef.getSchemaName( "W" )%>');
  ELSE
    BEGIN
      EXECUTE IMMEDIATE '
        SELECT NVL(COUNT(1),0) FROM <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')' INTO vl_Existe;
    EXCEPTION WHEN OTHERS THEN vl_Existe := 0;
    END;
    
    IF vl_Existe <> 0 THEN
      -- Truncamiento de la tabla temporal de trabajo de movimientos
      vl_SQL := 'ALTER TABLE <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || ' TRUNCATE PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM''))';
      
      BEGIN
        <%=odiRef.getSchemaName( "D" )%>.PKG_OBJETO_ODI.SPU_CREAR_TABLA(vl_SQL, vl_TablaTemp, '<%=odiRef.getSchemaName( "W" )%>');
      EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20102,'Ocurrió un error al truncar la tabla de trabajo de estadisticos de cuentas de saldos para la fecha.');
      END;
    END IF;
  END IF;
  
  vl_SQL := '
    SELECT /*+PARALLEL(8)*/ ahs.Periodo, ahs.Cod_Producto, ahs.Sub_Producto, ahs.Cod_Cuenta, ahs.Tipo_Identificacion,
           ahs.Nro_Identificacion, ahs.Ofi_Radicacion, ahs.Saldo_Final, ahs.Saldo_Minimo, ahs.Saldo_Maximo, ahs.Mediana_Saldo,
           ahs.Saldo_Promedio, ahm.Cantidad_CR, ahm.Valor_CR, ahm.Promedio_CR, ahm.Mediana_CR, ahm.Cantidad_DB,
           ahm.Valor_DB, ahm.Promedio_DB, ahm.Mediana_DB
    FROM <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTempSal || ' PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) ahs
    LEFT JOIN <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTempMov || ' PARTITION FOR (TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) ahm
    ON (ahs.Periodo = ahm.Periodo AND
        ahs.Cod_Producto = ahm.Cod_Producto AND ahs.Cod_Cuenta = ahm.Cod_Cuenta AND
        ahs.Tipo_Identificacion = ahm.Tipo_Identificacion AND ahs.Nro_Identificacion = ahm.Nro_Identificacion)';
  
  OPEN vl_CursorSQL FOR vl_SQL;
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tabstats LIMIT Cr_Limit_Bulk;
    FORALL ind IN 1..vl_tabstats.Count
      EXECUTE IMMEDIATE '
        INSERT /*+APPEND_VALUES*/ INTO <%=odiRef.getSchemaName( "D" )%>.' || vl_TablaTemp || '
        (Periodo, Cod_Producto, Sub_Producto, Cod_Cuenta, Tipo_Identificacion, Nro_Identificacion,
         Ofi_Radicacion, Saldo_Final, Saldo_Minimo, Saldo_Maximo, Mediana_Saldo, Saldo_Promedio,
         Cantidad_CR, Valor_CR, Promedio_CR, Mediana_CR, Cantidad_DB, Valor_DB, Promedio_DB, Mediana_DB)
        VALUES(:1, :2, :3, :4, :5, :6, :7, :8, :9, :10, :11, :12, :13, :14, :15, :16, :17, :18, :19, :20)'
      USING vl_tabstats(ind).Periodo, vl_tabstats(ind).Cod_Producto, vl_tabstats(ind).Sub_Producto, vl_tabstats(ind).Cod_Cuenta,
            vl_tabstats(ind).Tipo_Identificacion, vl_tabstats(ind).Nro_Identificacion, vl_tabstats(ind).Ofi_Radicacion,
            vl_tabstats(ind).Saldo_Final, vl_tabstats(ind).Saldo_Minimo, vl_tabstats(ind).Saldo_Maximo, vl_tabstats(ind).Mediana_Saldo,
            vl_tabstats(ind).Saldo_Promedio, vl_tabstats(ind).Cantidad_CR, vl_tabstats(ind).Valor_CR, vl_tabstats(ind).Promedio_CR,
            vl_tabstats(ind).Mediana_CR, vl_tabstats(ind).Cantidad_DB, vl_tabstats(ind).Valor_DB, vl_tabstats(ind).Promedio_DB,
            vl_tabstats(ind).Mediana_DB;
    COMMIT;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  CLOSE vl_CursorSQL;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27232]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d091b55e-3484-4b17-877f-3325dc642eac]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6209]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[30]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_debito_exo]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1e107d2a-9577-4ab2-89da-2c9d83503354]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27232]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,  
   TIPO_MOVIMIENTO                  VARCHAR2(4),
   MOTIVO_CONCEPTO                  VARCHAR2(4), 
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_DEBITO_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
        SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos			
                TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                 ah.Motivo_Concepto,
                 ' || fn_verificar_exogena(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'DB') || ' Apl_Exogena, 
                 ''DB'' Naturaleza,
                 NULL Valor_CR,
                 ah.Valor_Total Valor_DB,
                 ah.nro_transac
				FROM <%=odiRef.getSchemaName( "D" )%>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
						JOIN <%=odiRef.getSchemaName( "D" )%>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
						LEFT JOIN (select Tipo_Identificacion,
                                                            Nro_Identificacion, 
                                                            cod_cuenta
                                                            from <%=odiRef.getSchemaName( "D" )%>.WTMP_STATS_CUENTAS_SALDOS 
                                                            WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
                                                            
					WHERE tm.Operacion = 2
						AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27207]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[938fc622-4752-4961-b23e-1c43b2504c72]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6207]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[20]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Crear tablas de movimientos Debito y Credito]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[68a7af49-ca72-4b4e-a841-b16e7361d9a8]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27207]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[BEGIN

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_DEBITO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_DEBITO -- Creacion de la tabla temporal para la extraccion de informacion de debitos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,   
          TIPO_MOVIMIENTO               VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_CREDITO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_CREDITO -- Creacion de la tabla temporal para la extraccion de informacion de creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,   
          TIPO_MOVIMIENTO       VARCHAR2(4),
          MOTIVO_CONCEPTO       VARCHAR2(4),
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_DEBITO_CHE';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_DEBITO_CHE -- Creacion de la tabla temporal para la extraccion de informacion de debitos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO                  VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 		  
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8),
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_STATS_CUENTAS_CREDITO_CHE';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_STATS_CUENTAS_CREDITO_CHE -- Creacion de la tabla temporal para la extraccion de informacion de creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,     
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2)   ,
          NRO_TRANSACCION      NUMBER(8)  ,
          RANKEO               NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITO_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITO_EXO -- Creacion de la tabla temporal para la extraccion de informacion de debitos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   , 
          TIPO_MOVIMIENTO                  VARCHAR2(4),
          MOTIVO_CONCEPTO                  VARCHAR2(4), 
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2),   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_CREDITO_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_CREDITO_EXO -- Creacion de la tabla temporal para la extraccion de informacion de creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,    
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITO_CHE_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITO_CHE_EXO -- Creacion de la tabla temporal para la extraccion de informacion de debitos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO       VARCHAR2(4),
          MOTIVO_CONCEPTO       VARCHAR2(4),
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_CREDITO_CHE_EXO';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_CREDITO_CHE_EXO -- Creacion de la tabla temporal para la extraccion de informacion de creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,     
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8))
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEBITOS_CREDITOS CASCADE CONSTRAINTS';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEBITOS_CREDITOS -- Creacion de la tabla temporal para la union de debitos y creditos
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;
   
   BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_CNTS_DEB_CRED ON WTMP_CUENTAS_DEBITOS_CREDITOS
            (
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            nro_transaccion,
            Rankeo
            )
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;


   BEGIN
      EXECUTE IMMEDIATE 'DROP TABLE WTMP_CUENTAS_DEB_CRED_CHEQ CASCADE CONSTRAINTS';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;

   BEGIN
      EXECUTE IMMEDIATE
         'CREATE TABLE WTMP_CUENTAS_DEB_CRED_CHEQ -- Creacion de la tabla temporal para la union de debitos y creditos cheques
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)   ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2)   ,   
          VALOR_DB             NUMBER(20,2),
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
   EXCEPTION
      WHEN OTHERS
      THEN
         NULL;
   END;
   
   BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_CNTS_DEB_CRED_CHEQ ON WTMP_CUENTAS_DEB_CRED_CHEQ
            (
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            nro_transaccion,
            Rankeo
            )
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;

   BEGIN
      BEGIN
         EXECUTE IMMEDIATE 'DROP TABLE WTMP_CNTS_DEB_CRED_EXCL_CHEQUE CASCADE CONSTRAINTS';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;

      BEGIN
         EXECUTE IMMEDIATE
          'CREATE TABLE WTMP_CNTS_DEB_CRED_EXCL_CHEQUE -- Creacion de la tabla temporal para la exclusión de cheques debito y credito
          (PERIODO              DATE ,             
          COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
          COD_CUENTA           VARCHAR2(12 CHAR) ,
          TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
          NRO_IDENTIFICACION   NUMBER(16)  ,
          TIPO_MOVIMIENTO      VARCHAR2(4)  ,
          MOTIVO_CONCEPTO      VARCHAR2(4)  ,
          APL_EXOGENA          CHAR(2)     ,      
          NATURALEZA           CHAR(2)     ,      
          VALOR_CR             NUMBER(20,2) ,   
          VALOR_DB             NUMBER(20,2) ,
          NRO_TRANSACCION      NUMBER(8) ,
          RANKEO NUMBER)
          PARALLEL 
          NOLOGGING';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
      
      BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_DEB_CRED_EXCL_EXO ON WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
            (PERIODO, COD_PRODUCTO, COD_CUENTA, TIPO_IDENTIFICACION, NRO_IDENTIFICACION)
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
	  BEGIN
         EXECUTE IMMEDIATE
          'CREATE INDEX IDX_DEB_CRED_ESTADISTICOS ON WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
            (APL_EXOGENA)
            NOLOGGING
            PARALLEL';
      EXCEPTION
         WHEN OTHERS
         THEN
            NULL;
      END;
   
   END;
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27251]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[75fb98ae-0f8c-424f-ad09-267cd2dacce6]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6218]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[120]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Union debitos y creditos cheques]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[7b258ac2-709d-4923-ad54-e01f94ef4aae]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27251]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql_creditos clob;
  vl_sql_debitos clob;
  type T_TABCAMPOS_CREDITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   type T_TABCAMPOS_DEBITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat_creditos IS TABLE OF T_TABCAMPOS_CREDITOS INDEX BY PLS_INTEGER;
   vl_tab_creditos t_tabdat_creditos;
   VL_CURSORSQL_CREDITOS SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;
   
   TYPE t_tabdat_debitos IS TABLE OF T_TABCAMPOS_DEBITOS INDEX BY PLS_INTEGER;
   vl_tab_debitos t_tabdat_debitos;
   VL_CURSORSQL_DEBITOS SYS_REFCURSOR;

      
BEGIN

    --------------------- CREDITOS --------------------

    BEGIN
        vl_sql_creditos := 
            'INSERT INTO WTMP_CUENTAS_DEB_CRED_CHEQ
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_CREDITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_CREDITO_CHE';
                                
            
            LOOP
            FETCH VL_CURSORSQL_CREDITOS BULK COLLECT INTO vl_tab_creditos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_creditos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_creditos(i).PERIODO               ,
                        vl_tab_creditos(i).COD_PRODUCTO          ,
                        vl_tab_creditos(i).COD_CUENTA            ,
                        vl_tab_creditos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_creditos(i).NRO_IDENTIFICACION    ,
                        vl_tab_creditos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_creditos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_creditos(i).APL_EXOGENA           ,
                        vl_tab_creditos(i).NATURALEZA            ,
                        vl_tab_creditos(i).VALOR_CR              ,
                        vl_tab_creditos(i).VALOR_DB              ,
                        vl_tab_creditos(i).NRO_TRANSACCION       ,
                        vl_tab_creditos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_CREDITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_CREDITOS;    
    END;
    
    --------------------- DEBITOS --------------------
    
    BEGIN
        vl_sql_debitos := 
            'INSERT INTO WTMP_CUENTAS_DEB_CRED_CHEQ
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_DEBITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_DEBITO_CHE';
                                
            
            LOOP
            FETCH VL_CURSORSQL_DEBITOS BULK COLLECT INTO vl_tab_debitos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_debitos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_debitos(i).PERIODO               ,
                        vl_tab_debitos(i).COD_PRODUCTO          ,
                        vl_tab_debitos(i).COD_CUENTA            ,
                        vl_tab_debitos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_debitos(i).NRO_IDENTIFICACION    ,
                        vl_tab_debitos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_debitos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_debitos(i).APL_EXOGENA           ,
                        vl_tab_debitos(i).NATURALEZA            ,
                        vl_tab_debitos(i).VALOR_CR              ,
                        vl_tab_debitos(i).VALOR_DB              ,
                        vl_tab_debitos(i).NRO_TRANSACCION       ,
                        vl_tab_debitos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_DEBITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_DEBITOS;    
    END;  
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27250]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[b09996d3-1a72-40be-86f0-3ef02e2e9e9c]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6217]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[110]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Union debitos y creditos exogena]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d2429e86-243a-42f4-9fcf-a1d634034db3]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27250]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql_creditos clob;
  vl_sql_debitos clob;
  type T_TABCAMPOS_CREDITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   type T_TABCAMPOS_DEBITOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat_creditos IS TABLE OF T_TABCAMPOS_CREDITOS INDEX BY PLS_INTEGER;
   vl_tab_creditos t_tabdat_creditos;
   VL_CURSORSQL_CREDITOS SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;
   
   TYPE t_tabdat_debitos IS TABLE OF T_TABCAMPOS_DEBITOS INDEX BY PLS_INTEGER;
   vl_tab_debitos t_tabdat_debitos;
   VL_CURSORSQL_DEBITOS SYS_REFCURSOR;

      
BEGIN

    --------------------- CREDITOS --------------------

    BEGIN
        vl_sql_creditos := 
            'INSERT INTO WTMP_CUENTAS_DEBITOS_CREDITOS
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_CREDITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_CREDITO';
                                
            
            LOOP
            FETCH VL_CURSORSQL_CREDITOS BULK COLLECT INTO vl_tab_creditos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_creditos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_creditos(i).PERIODO               ,
                        vl_tab_creditos(i).COD_PRODUCTO          ,
                        vl_tab_creditos(i).COD_CUENTA            ,
                        vl_tab_creditos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_creditos(i).NRO_IDENTIFICACION    ,
                        vl_tab_creditos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_creditos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_creditos(i).APL_EXOGENA           ,
                        vl_tab_creditos(i).NATURALEZA            ,
                        vl_tab_creditos(i).VALOR_CR              ,
                        vl_tab_creditos(i).VALOR_DB              ,
                        vl_tab_creditos(i).NRO_TRANSACCION       ,
                        vl_tab_creditos(i).RANKEO                 ;
                        commit;
            EXIT WHEN VL_CURSORSQL_CREDITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_CREDITOS;    
    END;
    
    --------------------- DEBITOS --------------------
    
    BEGIN
        vl_sql_debitos := 
            'INSERT INTO WTMP_CUENTAS_DEBITOS_CREDITOS
             (PERIODO             ,
             COD_PRODUCTO        ,
             COD_CUENTA          ,
             TIPO_IDENTIFICACION ,
             NRO_IDENTIFICACION  ,
             TIPO_MOVIMIENTO     ,
             MOTIVO_CONCEPTO     ,
             APL_EXOGENA         ,
             NATURALEZA          ,
             VALOR_CR            ,
             VALOR_DB            ,
             NRO_TRANSACCION     ,
             RANKEO
             )
             VALUES
             (
             :1,
             :2,
             :3,
             :4,
             :5,
             :6,
             :7,
             :8,
             :9,
             :10,
             :11,
             :12,
             :13)';
            
            open VL_CURSORSQL_DEBITOS for '
            SELECT /*+PARALLEL(8)*/
                    Periodo,
                    Cod_Producto,
                    Cod_Cuenta,
                    Tipo_Identificacion,
                    Nro_Identificacion,
                    Tipo_movimiento,
                    Motivo_concepto,
                    Apl_Exogena,
                    Naturaleza,
                    Valor_CR,
                    Valor_DB,
                    Nro_transaccion,
                    Rankeo
                FROM WTMP_STATS_CUENTAS_DEBITO';
                                
            
            LOOP
            FETCH VL_CURSORSQL_DEBITOS BULK COLLECT INTO vl_tab_debitos LIMIT Cr_Limit_Bulk;
            FORALL i IN 1..vl_tab_debitos.Count
                EXECUTE IMMEDIATE 
                vl_sql_creditos  
                USING  
                        vl_tab_debitos(i).PERIODO               ,
                        vl_tab_debitos(i).COD_PRODUCTO          ,
                        vl_tab_debitos(i).COD_CUENTA            ,
                        vl_tab_debitos(i).TIPO_IDENTIFICACION   ,
                        vl_tab_debitos(i).NRO_IDENTIFICACION    ,
                        vl_tab_debitos(i).TIPO_MOVIMIENTO       ,
                        vl_tab_debitos(i).MOTIVO_CONCEPTO       ,
                        vl_tab_debitos(i).APL_EXOGENA           ,
                        vl_tab_debitos(i).NATURALEZA            ,
                        vl_tab_debitos(i).VALOR_CR              ,
                        vl_tab_debitos(i).VALOR_DB              ,
                        vl_tab_debitos(i).NRO_TRANSACCION       ,
                        vl_tab_debitos(i).RANKEO                ;
                        commit;
            EXIT WHEN VL_CURSORSQL_DEBITOS%NOTFOUND;
            END LOOP;
            close VL_CURSORSQL_DEBITOS;    
    END;  
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27252]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[89a173cf-8080-495f-8d16-1c0fb13916a3]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6219]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[130]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[minus logico debitos y creditos, exogena y cheques]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[14bb99be-8ee3-4a73-9213-9f95d7fd7b45]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27252]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4 BYTE),
   MOTIVO_CONCEPTO      VARCHAR2(4 BYTE),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2),   
   VALOR_DB             NUMBER(20,2),
   NRO_TRANSACCION      NUMBER(8)   ,
   RANKEO        NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 10000;
      
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CNTS_DEB_CRED_EXCL_CHEQUE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
    open VL_CURSORSQL for '
    SELECT /*+PARALLEL(8)*/ -- Minus lógico
            CDC.Periodo,
            CDC.Cod_Producto,
            CDC.Cod_Cuenta,
            CDC.Tipo_Identificacion,
            CDC.Nro_Identificacion,
            CDC.Tipo_movimiento,
            CDC.Motivo_concepto,
            CDC.Apl_Exogena,
            CDC.Naturaleza,
            CDC.Valor_CR,
            CDC.Valor_DB,
            CDC.nro_transaccion,
            CDC.Rankeo
                FROM WTMP_CUENTAS_DEBITOS_CREDITOS CDC LEFT JOIN WTMP_CUENTAS_DEB_CRED_CHEQ CDCC
                ON  
                (
                CDC.Periodo = CDCC.Periodo and
                CDC.Cod_Producto = CDCC.Cod_Producto and
                CDC.Cod_Cuenta = CDCC.Cod_Cuenta and
                CDC.Tipo_Identificacion = CDCC.Tipo_Identificacion and
                CDC.Nro_Identificacion = CDCC.Nro_Identificacion and
                CDC.Apl_Exogena = CDCC.Apl_Exogena and
                CDC.Naturaleza = CDCC.Naturaleza and
                NVL(CDC.Valor_CR,-1) = NVL(CDCC.Valor_CR,-1) and
                NVL(CDC.Valor_DB,-1) = NVL(CDCC.Valor_DB,-1) and
                CDC.nro_transaccion = CDCC.nro_transaccion and
                CDC.Rankeo = CDCC.Rankeo
                )
                WHERE
                CDCC.Periodo IS NULL';
  
  LOOP
    FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
             vl_tab(i).PERIODO                   ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
                 vl_tab(i).RANKEO                 ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27238]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[ad490834-5958-443d-804e-1e8f9752e2c2]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6215]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[90]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_debito_che]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[2ec9afb5-9696-4678-a59e-97749a591d88]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27238]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4), 
   MOTIVO_CONCEPTO      VARCHAR2(4),   
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)   ,   
   VALOR_DB             NUMBER(20,2)   ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_DEBITO_CHE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO      ,
    MOTIVO_CONCEPTO      , 
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
 	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ -- debitos a excluir
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento      ,
            Motivo_Concepto      , 
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_DB, Nro_transaccion ORDER BY Periodo, Valor_DB) Rankeo
			FROM WTMP_CUENTAS_DEBITO_CHE_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO		 ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
 END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27239]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[919c75b2-9fb2-465a-9360-e7bccf682ec4]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6216]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[100]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_credito_che]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[6c9bee8e-4cf2-4bde-baf4-20a1ed74d872]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27239]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
    MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

      
begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_CREDITO_CHE
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
   MOTIVO_CONCEPTO      ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ -- debitos a excluir
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento,
            Motivo_Concepto,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_CR, Nro_transaccion ORDER BY Periodo, Valor_CR) Rankeo
		FROM WTMP_CUENTAS_CREDITO_CHE_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
                 vl_tab(i).RANKEO	         ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27234]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[f9f01b12-2871-42d3-a7e1-51eeea6c8bf6]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6211]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[50]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_debito_che_exo]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[0e1bcc51-26eb-470f-9cc2-3425d2625a5f]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27234]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4), 
   MOTIVO_CONCEPTO      VARCHAR2(4),
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2) ,   
   VALOR_DB             NUMBER(20,2) ,
   NRO_TRANSACCION      NUMBER(8))   ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_DEBITO_CHE_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO      ,
    MOTIVO_CONCEPTO      , 
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos			
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
				 ah.Tipo_Movimiento, 
				 ah.Motivo_Concepto, 
                 CASE WHEN ah.Cod_Producto IN (''0550'',''0560'',''0570'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0093'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0034'') AND ah.Motivo_Concepto IN (''0087'') THEN ''SI'' 
		 ELSE ''NO'' END Apl_Exogena,
                 ''DB'' Naturaleza,
                 NULL Valor_CR,
                 ah.Valor_Total Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN -1
                 ELSE ah.nro_transac END nro_transac
                    FROM <%=odiRef.getSchemaName( "D" )%>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                    JOIN <%=odiRef.getSchemaName( "D" )%>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                    LEFT JOIN (select Tipo_Identificacion,
                                      Nro_Identificacion, 
                                      cod_cuenta
                                      from <%=odiRef.getSchemaName( "D" )%>.WTMP_STATS_CUENTAS_SALDOS 
                                      WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
			WHERE tm.Operacion = 2
                          AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27236]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[c5e8edcc-d5b4-47b6-a929-b864bf0b2ca2]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6213]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[70]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_debito]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cdae66f8-359c-4805-9a0f-2c1fe8ccc275]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27236]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,   
   TIPO_MOVIMIENTO      VARCHAR2(4),
   MOTIVO_CONCEPTO      VARCHAR2(4), 
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO               NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   
begin   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_DEBITO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO              
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los debitos
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            TIPO_MOVIMIENTO     ,
            MOTIVO_CONCEPTO     ,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
            ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_DB, Nro_transaccion  ORDER BY Periodo,Valor_DB) Rankeo
		FROM WTMP_CUENTAS_DEBITO_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO     ,
                 vl_tab(i).MOTIVO_CONCEPTO     ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO               ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27235]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[8cbb56f2-6f07-4226-81c3-9438fb9b3e20]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6212]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[60]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_credito_che_exo]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[cde1181e-0936-4746-92a2-a4888553b53b]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27235]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   , 
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8))   ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_CREDITO_CHE_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO      ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los creditos			
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                  ah.Motivo_Concepto,
                 CASE WHEN ah.Cod_Producto IN (''0550'',''0560'',''0570'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI''                  
                 WHEN ah.TIPO_MOVIMIENTO IN (''0048'') AND ah.Motivo_Concepto IN (''0000'') THEN ''SI''
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0093'') THEN ''SI'' 
                 WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN ''SI'' 
                 ELSE ''NO'' END Apl_Exogena,
                 ''CR'' Naturaleza, 
                 ah.Valor_Total Valor_CR,
                 NULL Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0055'') AND ah.Motivo_Concepto IN (''0001'') THEN -1
                 ELSE ah.nro_transac END nro_transac
                    FROM <%=odiRef.getSchemaName( "D" )%>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                    JOIN <%=odiRef.getSchemaName( "D" )%>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                    LEFT JOIN (select Tipo_Identificacion,
                                      Nro_Identificacion, 
                                      cod_cuenta
                                      from <%=odiRef.getSchemaName( "D" )%>.WTMP_STATS_CUENTAS_SALDOS 
                                      WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
			WHERE tm.Operacion = 2
			AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27237]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[df21c80e-bcc5-4a25-8588-d9bc48a67154]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6214]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[80]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_stats_cuentas_credito]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[49dbfe6c-9590-41f4-839f-b596440f1844]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27237]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)  ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2)  ,   
   VALOR_DB             NUMBER(20,2)  ,
   NRO_TRANSACCION      NUMBER(8)     ,
   RANKEO		NUMBER) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_STATS_CUENTAS_CREDITO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION     ,
    RANKEO
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12,
   :13)';
  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/ 		
            Periodo,
            Cod_Producto,
            Cod_Cuenta,
            Tipo_Identificacion,
            Nro_Identificacion,
            Tipo_Movimiento,
            Motivo_Concepto,
            Apl_Exogena,
            Naturaleza,
            Valor_CR,
            Valor_DB,
            Nro_transaccion,
		ROW_NUMBER() OVER (PARTITION BY Naturaleza, cod_cuenta, Valor_CR, Nro_transaccion ORDER BY Periodo, Valor_CR) rankeo
                	FROM WTMP_CUENTAS_CREDITO_EXO';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO        ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ,
		 vl_tab(i).RANKEO                ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27233]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[d7b31924-5453-45ba-bc75-022c545e5136]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[6210]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[40]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Insertar en wtmp_cuentas_credito_exo]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[06a61458-d1f4-4ee8-a0b7-5e4622fb98cb]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[27233]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  V_PERIODO DATE := TRUNC(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'MM');
  V_ULTIMO_DIA NUMBER := TO_NUMBER(TO_CHAR(LAST_DAY(V_PERIODO),'DD'));
  vl_sql clob;
  type T_TABCAMPOS is RECORD 
  (PERIODO              DATE ,             
   COD_PRODUCTO         VARCHAR2(4 CHAR)  ,
   COD_CUENTA           VARCHAR2(12 CHAR) ,
   TIPO_IDENTIFICACION  VARCHAR2(2 CHAR)  ,
   NRO_IDENTIFICACION   NUMBER(16)   ,
   TIPO_MOVIMIENTO      VARCHAR2(4)  ,
   MOTIVO_CONCEPTO      VARCHAR2(4)  ,
   APL_EXOGENA          CHAR(2)     ,      
   NATURALEZA           CHAR(2)     ,      
   VALOR_CR             NUMBER(20,2) ,   
   VALOR_DB             NUMBER(20,2) ,
   NRO_TRANSACCION      NUMBER(8)) ;
   
   TYPE t_tabdat IS TABLE OF t_tabcampos INDEX BY PLS_INTEGER;
   vl_tab t_tabdat;
   vl_CursorSQL SYS_REFCURSOR;
   Cr_Limit_Bulk NATURAL DEFAULT 3000;

   FUNCTION fn_verificar_exogena(p_fecha DATE, p_Naturaleza VARCHAR2) RETURN VARCHAR2 IS
    vl_Atributos CLOB := '';
    vl_Valores CLOB := ' ';
    vl_Respuesta CLOB := 'CASE ';
    
    CURSOR cr_Filtros IS
    SELECT Cod_Fil, Resultado FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_CTAS
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Naturaleza = p_Naturaleza;
    
    CURSOR cr_FiltrosAtrib(p_Filtro VARCHAR2) IS
    SELECT Fil_Atr, Operador FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_ATR
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro;
    
    CURSOR cr_FiltrosValores(p_Filtro VARCHAR2, p_Atributo VARCHAR2) IS
    SELECT Valor_Fil_Atr FROM <%=odiRef.getSchemaName( "D" )%>.STG_EXO_FILTROS_VAL
    WHERE Periodo = TRUNC(p_Fecha,'YEAR') AND Cod_Fil = p_Filtro AND Fil_Atr = p_Atributo;
  BEGIN
    FOR fil IN cr_Filtros LOOP
      vl_Atributos := ' ';
      FOR atr IN cr_FiltrosAtrib(fil.Cod_Fil) LOOP
        vl_Valores := ' ';
        FOR val IN cr_FiltrosValores(fil.Cod_Fil, atr.Fil_Atr) LOOP
	  IF vl_Valores = ' ' THEN
	    vl_Valores := val.Valor_Fil_Atr;
	  ELSE
	    vl_Valores := vl_Valores || ',' || val.Valor_Fil_Atr;
	  END IF;
	END LOOP;
        
        IF atr.Operador LIKE '%IN%' OR atr.Operador LIKE '%NOT IN%' THEN
	  vl_Valores := '(' || vl_Valores || ')';
        END IF;
	
	IF vl_Atributos = ' ' THEN
	  vl_Atributos := atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	ELSE
	  vl_Atributos := vl_Atributos || ' AND ' || atr.Fil_Atr || ' ' || atr.Operador || ' ' || vl_Valores;
	END IF;
      END LOOP;
      
      vl_Respuesta := vl_Respuesta || ' WHEN ' || vl_Atributos || ' THEN ''' || fil.Resultado || '''';
    END LOOP;
    vl_Respuesta := vl_Respuesta || ' ELSE ''SI'' END ';
    RETURN vl_respuesta;
  END fn_verificar_exogena;
   
begin
   
  vl_sql := 
  'INSERT INTO WTMP_CUENTAS_CREDITO_EXO
   (PERIODO             ,
    COD_PRODUCTO        ,
    COD_CUENTA          ,
    TIPO_IDENTIFICACION ,
    NRO_IDENTIFICACION  ,
    TIPO_MOVIMIENTO     ,
    MOTIVO_CONCEPTO     ,
    APL_EXOGENA         ,
    NATURALEZA          ,
    VALOR_CR            ,
    VALOR_DB            ,
    NRO_TRANSACCION
   )
   VALUES
   (
   :1,
   :2,
   :3,
   :4,
   :5,
   :6,
   :7,
   :8,
   :9,
   :10,
   :11,
   :12)';
  
  FOR V_CONTADOR IN 1..V_ULTIMO_DIA
	LOOP  
	open VL_CURSORSQL for '
	SELECT /*+PARALLEL(8)*/  -- Se Obtienen los credito		
			     TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'') Periodo,
                 ah.Cod_Producto,
                 ah.Cod_Cuenta,
                 sal.Tipo_Identificacion,
                 sal.Nro_Identificacion,
                 ah.Tipo_Movimiento,
                 ah.Motivo_Concepto,
                 ' || fn_verificar_exogena(TO_DATE('#GLOBAL.VAR_PERIODO','YYYYMMDD'),'CR') || ' Apl_Exogena, 
                 ''CR'' Naturaleza,
                 ah.Valor_Total Valor_CR,
                 NULL Valor_DB,
                 CASE WHEN ah.TIPO_MOVIMIENTO IN (''0036'',''0035'',''0038'',''0039'') AND ah.Motivo_Concepto IN (''0000'') AND NVL( ah.Valor_Cheque,0) > 0 THEN -1
                 ELSE ah.nro_transac END nro_transac
                  FROM <%=odiRef.getSchemaName( "D" )%>.AH_MOVTO_DIARIA PARTITION FOR (TO_DATE('''||TO_CHAR(V_PERIODO,'YYYYMM')||LPAD(V_CONTADOR,2,'0')||''',''YYYYMMDD'')) ah 
                  JOIN <%=odiRef.getSchemaName( "D" )%>.STG_EXO_TIPOS_MOVS tm ON (ah.Tipo_Movimiento = tm.Cod_Tipo_Movimiento)
                  LEFT JOIN (select Tipo_Identificacion,
                                    Nro_Identificacion, 
                                    cod_cuenta
                                    from <%=odiRef.getSchemaName( "D" )%>.WTMP_STATS_CUENTAS_SALDOS 
                                    WHERE Periodo = TRUNC(TO_DATE(''#GLOBAL.VAR_PERIODO'',''YYYYMMDD''),''MM'')) sal ON (ah.cod_cuenta = sal.cod_cuenta)
                    WHERE tm.Operacion = 1
                      AND tm.Producto = ''CUENTAS''';
						
  
  LOOP
	FETCH vl_CursorSQL BULK COLLECT INTO vl_tab LIMIT Cr_Limit_Bulk;
    FORALL i IN 1..vl_tab.Count
      EXECUTE IMMEDIATE 
        VL_SQL  
        USING  
	         vl_tab(i).PERIODO               ,
                 vl_tab(i).COD_PRODUCTO          ,
                 vl_tab(i).COD_CUENTA            ,
                 vl_tab(i).TIPO_IDENTIFICACION   ,
                 vl_tab(i).NRO_IDENTIFICACION    ,
                 vl_tab(i).TIPO_MOVIMIENTO       ,
                 vl_tab(i).MOTIVO_CONCEPTO       ,
                 vl_tab(i).APL_EXOGENA           ,
                 vl_tab(i).NATURALEZA            ,
                 vl_tab(i).VALOR_CR              ,
                 vl_tab(i).VALOR_DB              ,
                 vl_tab(i).NRO_TRANSACCION       ;
                 commit;
  EXIT WHEN vl_CursorSQL%NOTFOUND;
  END LOOP;
  close VL_CURSORSQL;
  END LOOP;
END;
]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpLineTrt">
		<Field name="AlwaysExe" type="java.lang.String"><![CDATA[1]]></Field>
	<Field name="BrpId" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColConnectId" type="java.lang.String">null</Field>
	<Field name="ColContextCode" type="java.lang.String">null</Field>
	<Field name="ColIndCommit" type="java.lang.String">null</Field>
	<Field name="ColIsolLevel" type="java.lang.String">null</Field>
	<Field name="ColITxt" type="com.sunopsis.sql.DbInt"><![CDATA[null]]></Field>
	<Field name="ColLschemaName" type="java.lang.String">null</Field>
	<Field name="ColPlanComp" type="java.lang.String">null</Field>
	<Field name="ColTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="DefConnectId" type="java.lang.String">null</Field>
	<Field name="DefContextCode" type="java.lang.String">null</Field>
	<Field name="DefIndCommit" type="java.lang.String">null</Field>
	<Field name="DefIsolLevel" type="java.lang.String">null</Field>
	<Field name="DefITxt" type="com.sunopsis.sql.DbInt"><![CDATA[43975]]></Field>
	<Field name="DefLschemaName" type="java.lang.String"><![CDATA[STG_TRIBUTARIO]]></Field>
	<Field name="DefPlanComp" type="java.lang.String">null</Field>
	<Field name="DefTechno" type="java.lang.String"><![CDATA[ORACLE]]></Field>
	<Field name="FirstDate" type="java.sql.Timestamp">null</Field>
	<Field name="FirstUser" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[1ec2cd7e-b213-4b4b-9661-d4f109c6ab8e]]></Field>
	<Field name="IndErr" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogFinalCmd" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="IndLogMethod" type="java.lang.String">null</Field>
	<Field name="IndLogNb" type="java.lang.String">null</Field>
	<Field name="ILineTrt" type="com.sunopsis.sql.DbInt"><![CDATA[10829]]></Field>
	<Field name="ITrt" type="com.sunopsis.sql.DbInt"><![CDATA[1623]]></Field>
	<Field name="KcmAk" type="java.lang.String">null</Field>
	<Field name="KcmCond" type="java.lang.String">null</Field>
	<Field name="KcmErrDel" type="java.lang.String">null</Field>
	<Field name="KcmJoin" type="java.lang.String">null</Field>
	<Field name="KcmNull" type="java.lang.String">null</Field>
	<Field name="KcmPk" type="java.lang.String">null</Field>
	<Field name="KimDrvdSel" type="java.lang.String">null</Field>
	<Field name="KimIdx" type="java.lang.String">null</Field>
	<Field name="KimJrn" type="java.lang.String">null</Field>
	<Field name="KimJrnPop" type="java.lang.String">null</Field>
	<Field name="KjmCreate" type="java.lang.String">null</Field>
	<Field name="KjmDrop" type="java.lang.String">null</Field>
	<Field name="KjmExtend" type="java.lang.String">null</Field>
	<Field name="KjmInstall" type="java.lang.String">null</Field>
	<Field name="KjmLock" type="java.lang.String">null</Field>
	<Field name="KjmPurge" type="java.lang.String">null</Field>
	<Field name="KjmSetInstall" type="java.lang.String">null</Field>
	<Field name="KjmSetUninstall" type="java.lang.String">null</Field>
	<Field name="KjmSubscribe" type="java.lang.String">null</Field>
	<Field name="KjmTableOrder" type="java.lang.String">null</Field>
	<Field name="KjmUninstall" type="java.lang.String">null</Field>
	<Field name="KjmUnlock" type="java.lang.String">null</Field>
	<Field name="KjmUnsubscribe" type="java.lang.String">null</Field>
	<Field name="KlmAfterInt" type="java.lang.String">null</Field>
	<Field name="KlmIdx" type="java.lang.String">null</Field>
	<Field name="KlmJrn" type="java.lang.String">null</Field>
	<Field name="KxmUsed" type="java.lang.String">null</Field>
	<Field name="LastDate" type="java.sql.Timestamp">null</Field>
	<Field name="LastUser" type="java.lang.String">null</Field>
	<Field name="LineType" type="java.lang.String">null</Field>
	<Field name="LogLevDet" type="java.lang.String"><![CDATA[3]]></Field>
	<Field name="MapTaskType" type="java.lang.String"><![CDATA[EM]]></Field>
	<Field name="OrdTrt" type="com.sunopsis.sql.DbInt"><![CDATA[140]]></Field>
	<Field name="SqlName" type="java.lang.String"><![CDATA[Excluir Movimientos del mismo titular]]></Field>
	<Field name="SupportedSubtypes" type="java.lang.String">null</Field>
	<Field name="VariableDefs" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpTxtHeader">
		<Field name="Enc" type="java.lang.String"><![CDATA[0]]></Field>
	<Field name="EncKey" type="java.lang.String">null</Field>
 <Field name="EncKeyVect" type="java.lang.String">null</Field>
	<Field name="GlobalId" type="java.lang.String"><![CDATA[da838ac6-f78d-4b6d-8b9c-32ad2a58b854]]></Field>
	<Field name="ITxt" type="com.sunopsis.sql.DbInt"><![CDATA[43975]]></Field>
	<Field name="ITxtOrig" type="com.sunopsis.sql.DbInt"><![CDATA[102]]></Field>
	<Field name="SqlIndGrp" type="java.lang.String"><![CDATA[2]]></Field>
 <Field name="Txt" type="java.lang.String"><![CDATA[DECLARE
  vl_SQL CLOB := '';
  
BEGIN
  vl_SQL := '
    MERGE INTO WTMP_CNTS_DEB_CRED_EXCL_CHEQUE  TMP_FINAL
    USING (
	SELECT 
	TMP1.PERIODO    	    ,    
	TMP1.COD_PRODUCTO           ,
	TMP1.COD_CUENTA             ,
	TMP1.TIPO_IDENTIFICACION    ,
	TMP1.NRO_IDENTIFICACION     ,
	TMP1.TIPO_MOVIMIENTO        ,
	TMP1.MOTIVO_CONCEPTO        ,
	TMP1.APL_EXOGENA            ,
	TMP1.NATURALEZA             ,
	TMP1.VALOR_CR               ,
	TMP1.VALOR_DB               ,
	TMP1.NRO_TRANSAC            ,
	TMP1.REFERENCIA_2			,
	ROW_NUMBER() OVER (PARTITION BY trunc(TMP1.Periodo,''mm''), TMP1.Naturaleza, TMP1.cod_cuenta, TMP1.Valor_CR, TMP1.Valor_DB, TMP1.Nro_transac  ORDER BY TMP1.Periodo) AS RANKEO
	FROM <%=odiRef.getSchemaName( "D" )%>.WTMP_EXCL_MVTOS_MISMO_TITULAR TMP1
	)w
	ON(
	TMP_FINAL.TIPO_IDENTIFICACION	= w.TIPO_IDENTIFICACION AND
	TMP_FINAL.NRO_IDENTIFICACION 	= w.NRO_IDENTIFICACION   AND 
	TMP_FINAL.COD_CUENTA		= w.COD_CUENTA AND 
	TMP_FINAL.TIPO_MOVIMIENTO 	= w.TIPO_MOVIMIENTO AND 
	TMP_FINAL.MOTIVO_CONCEPTO 	= w.MOTIVO_CONCEPTO AND 
	TMP_FINAL.NATURALEZA 		= w.NATURALEZA AND
	NVL(TMP_FINAL.VALOR_CR,-1) 	= NVL(w.VALOR_CR,-1) AND 
	NVL(TMP_FINAL.VALOR_DB,-1) 	= NVL(w.VALOR_DB,-1) AND 
	TMP_FINAL.NRO_TRANSACCION	= w.NRO_TRANSAC AND
	TMP_FINAL.RANKEO 		= w.RANKEO
	)
	WHEN MATCHED THEN 
	UPDATE SET TMP_FINAL.APL_EXOGENA = w.APL_EXOGENA';
	
  BEGIN
    EXECUTE IMMEDIATE vl_SQL;
	COMMIT;
--	EXCEPTION WHEN OTHERS THEN RAISE_APPLICATION_ERROR(-20103,'Ocurrió un error al actualizar la exclusión para movimientos del mismo titular');
  END;
END;]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_FOLDER.1051]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[a68e2d03-ee24-475e-a84f-a3bdd9edc5cd]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[Generacion Reporte Exogena.Fuentes de Procesos]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_FOLDER]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[26.19]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_PROJECT.91]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[3ca12a7e-c53c-451d-ba35-3a8b2e3e3350]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[Generacion Reporte Exogena]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[26]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENFOLDER.735]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[219f1c69-8534-45ef-a19c-76e1c294b5ae]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[PROYECTOS BODEGA NUEVA.PN REPORTE EXOGENA.PN REXO ODS.PN REXO ODS PROCESO]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_SCENFOLDER.SNP_SCENFOLDER.SNP_SCENFOLDER.SNP_SCENFOLDER]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[22.18.11.19]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TRT.1623]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[4a881e94-ef88-41c4-af9f-f1a22ba247b3]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[Generacion Reporte Exogena.PRC_EXO_CALCULAR_STATS_CUENTAS]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_TRT]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[26.30]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCEN.7425]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[bd22c103-873e-4203-8f7c-adafef20a8de]]></Field>
 <Field name="RefObjFQName" type="java.lang.String"><![CDATA[Generacion Reporte Exogena.PRC_EXO_CALCULAR_STATS_CUENTAS.CASO_EXO_CALCULAR_STATS_CUENTAS Versión 001]]></Field>
 <Field name="RefObjFQType" type="java.lang.String"><![CDATA[SNP_PROJECT.SNP_TRT.SNP_SCEN]]></Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String"><![CDATA[26.30.43]]></Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_SCENSTEP.7425.1]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[2cc1d1fd-d674-4806-8b0b-57af68f16bd3]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.16351]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[e7e489d8-a18a-42ce-a92c-52268bb42e88]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.16352]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[188e7166-f760-48f7-92f5-f67c2ffce7b7]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_ORIGTXT.102]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String">null</Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.16359]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[eff6ad0a-b5e1-4355-91b3-db0702cc288a]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27232]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[1e107d2a-9577-4ab2-89da-2c9d83503354]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27207]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[68a7af49-ca72-4b4e-a841-b16e7361d9a8]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27251]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[7b258ac2-709d-4923-ad54-e01f94ef4aae]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27250]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[d2429e86-243a-42f4-9fcf-a1d634034db3]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27252]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[14bb99be-8ee3-4a73-9213-9f95d7fd7b45]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27238]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[2ec9afb5-9696-4678-a59e-97749a591d88]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27239]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[6c9bee8e-4cf2-4bde-baf4-20a1ed74d872]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27234]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[0e1bcc51-26eb-470f-9cc2-3425d2625a5f]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27236]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[cdae66f8-359c-4805-9a0f-2c1fe8ccc275]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27235]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[cde1181e-0936-4746-92a2-a4888553b53b]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27237]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[49dbfe6c-9590-41f4-839f-b596440f1844]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.27233]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[06a61458-d1f4-4ee8-a0b7-5e4622fb98cb]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.dbobj.SnpFKXRef">
		<Field name="RefKey" type="java.lang.String"><![CDATA[SNP_TXTHEADER.43975]]></Field>
	<Field name="RefObjGlobalId" type="java.lang.String"><![CDATA[da838ac6-f78d-4b6d-8b9c-32ad2a58b854]]></Field>
 <Field name="RefObjFQName" type="java.lang.String">null</Field>
 <Field name="RefObjFQType" type="java.lang.String">null</Field>
 <Field name="RefObjFQNameLengths" type="java.lang.String">null</Field>
</Object>
<Object class="com.sunopsis.dwg.DwgExportSummary">
		<Field name="ExpTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="InstObjNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="JoinNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyColNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="KeyNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="LinkDiagNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MorigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="MtxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OrigTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[16]]></Field>
	<Field name="OtherObjectsNb" type="com.sunopsis.sql.DbInt"><![CDATA[47]]></Field>
	<Field name="PlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="StepNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="TxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[16]]></Field>
	<Field name="UeOrigNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="UeUsedNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="VarPlanAgentNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="ScenTxtNb" type="com.sunopsis.sql.DbInt"><![CDATA[0]]></Field>
	<Field name="OdiVersion" type="java.lang.String"><![CDATA[12.2.1]]></Field>
	<Field name="OriginRepositoryID" type="com.sunopsis.sql.DbInt"><![CDATA[1]]></Field>
	<Field name="RepositoryVersion" type="java.lang.String"><![CDATA[05.02.01.08]]></Field>
</Object>
</SunopsisExport>
